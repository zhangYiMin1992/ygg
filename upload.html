<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>艺术品上传页面</title>
    <link rel="stylesheet" type="text/css" href="style/basic.css">
    <link rel="stylesheet" type="text/css" href="style/index.css">
    <meta name="Keywords" content="艺术品上传页面">
    <meta name="description" content="艺术品上传页面">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <meta property="qc:admins" content="2275617726564116375">
    <meta http-equiv="Cache-Control" content="no-transform ">
    <meta name="applicable-device" content="mobile">
    <meta name="viewport" content="minimal-ui=yes,width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
    <style>
        ::-webkit-scrollbar {
            width: 0px;
            height:0px;
        }

        img {
            border: none;
        }

        .upload_page{
            padding:.5rem 0 0 .17rem;            
        }

        .upload_page .titles_o{
            font:400 .12rem/.29rem "黑体";
            padding-top:.12rem ;
        }

        .upload_box{
            white-space: nowrap; 
            overflow-x: auto;
            font-size: 0;
            -webkit-overflow-scrolling: touch;
            overflow-scrolling: touch;

        }

        .preview_list,.upload_menu{
            display: inline-block;
            vertical-align: top;
            position: relative; 
            width: 0.9rem;
            height:0.9rem;
        }

        .preview_list{
            overflow: hidden;
            margin-right: 0.06rem;
            z-index:10;
        }

        .preview_list img{
            position: absolute;
        }

        .preview_list a{
            display: block;
            width: .25rem;
            height:.25rem;
            position: absolute;
            right:0.03rem;
            top:0.04rem;
            background:url(images/result.png) no-repeat 0 -1.55rem;
            background-size: 1.485rem 2.12rem;
            z-index:11;
        }

        .upload_menu{
            background: url(../images/upload.jpg)no-repeat;
            background-size:0.9rem 0.9rem;
        }

        .upload_menu input{
            width: 100%;
            height: 100%;
            opacity: 0;
        }

        .require{
            padding-right:.17rem;
            margin-top:.17rem;
        }

        .require dt{
            text-align: center;
            margin-bottom:.14rem;
        }

        .require dt a{
            display: inline-block;
            width:0.85rem;
            height:.25rem;
            line-height: .25rem;
            border:1px solid #251b19;
            border-radius: 0.02rem;
        }

        .require dd{
            height:0;
            overflow: hidden;
        }

        .require dd.show{
            height:auto;
        }

        .require dd p{

            padding-bottom:.22rem;
            color: #b9b9b9;
            font:400 .10rem/.16rem "黑体";
            /*transform: scale(0.88);
            transform-origin: left;*/
        }

        .pro_mes li{
            border-top:1px solid #f0f0f0;
            font:400 .12rem/.16rem "黑体";
            height:.37rem;
            line-height: .37rem;
            width: 100%;
            box-sizing: border-box;
            padding:0 .17rem 0 .17rem;
        }

        .pro_mes li input::-webkit-input-placeholder{
            color:#bbbbbb;
            font:400 .1rem/.12rem "黑体";
        }

        .pro_mes li input{
            color:#545454;
            font:400 .1rem/.12rem "黑体";
            width:73%;
            height:.3rem;
        }

        .pro_mes li span{
            float: right;
        }

        .hide {
          display: none;
        }

        /* line 9, ../sass/mpicker.scss */
        .mPicker-hide {
          visibility: hidden;
        }

        /* line 15, ../sass/mpicker.scss */
        .mPicker-pr {
          position: relative;
        }

        /* line 19, ../sass/mpicker.scss */
        .mPicker {
          width: 100%;
          height: 100%;
          position: fixed;
          top: 0;
          right: 0;
          bottom: 0;
          left: 0;
          z-index: 9999;
        }

        /*遮罩*/
        /* line 32, ../sass/mpicker.scss */
        .mPicker-mask {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          z-index: 9;
          background: #000;
          opacity: .7;
        }

        /*选中的线*/
        /* line 46, ../sass/mpicker.scss */
        .mPicker-active-box {
          position: absolute;
          top: 50%;
          left: 50%;
          width: 70%;
          margin-left: -35%;
          border-top: 1px solid #31b6e7;
          border-bottom: 1px solid #31b6e7;
        }

        /* line 56, ../sass/mpicker.scss */
        .mPicker-main {
          background: #d1d4db;
          box-sizing: border-box;
          position: absolute;
          bottom: 0;
          left: 0;
          width: 100%;
          z-index: 10;
          -webkit-transition: all .2s ease-out;
          transition: all .2s ease-out;
          -webkit-backface-visibility: hidden;
          -webkit-transform-style: preserve-3d;
          -webkit-transform: translate3d(0, 0, 0);
        }

        /* line 71, ../sass/mpicker.scss */
        .mPicker-main.mPicker-bottom {
          bottom: 0;
        }

        /* line 75, ../sass/mpicker.scss */
        .mPicker-main.mPicker-modal {
          -webkit-border-radius: 3px;
          border-radius: 3px;
          width: 264px;
          top: 50%;
          bottom: auto;
          left: 50%;
          margin-top: -127px;
          margin-left: -132px;
        }

        /* line 86, ../sass/mpicker.scss */
        .mPicker-main.down {
          transform: translateY(100%);
          -webkit-transform: translateY(100%);
        }

        /* line 91, ../sass/mpicker.scss */
        .mPicker-header {
          position: relative;
          height: 40px;
          line-height: 40px;
          text-align: center;
          border-bottom: 1px solid #31b6e7;
          color: #31b6e7;
          font-size: .14rem;
        }

        /* line 101, ../sass/mpicker.scss */
        .mPicker-footer {
          border-top: 1px solid #ccc;
          border-bottom: 1px solid #ccc;
          height: 36px;
          line-height: 36px;
          position: relative;
        }

        /* line 109, ../sass/mpicker.scss */
        .mPicker-content {
          overflow: hidden;
          z-index: 15;
          position: relative;
          display: box;
          display: -webkit-box;
          display: -moz-box;
          display: -ms-flexbox;
          display: -webkit-flex;
          display: flex;
          -webkit-box-sizing: border-box;
          box-sizing: border-box;
        }

        /* line 123, ../sass/mpicker.scss */
        .mPicker-list {
          -webkit-box-flex: 1;
          -moz-box-flex: 1;
          -webkit-flex: 1;
          -ms-flex: 1;
          flex: 1;
          width: 100%;
          position: relative;
          overflow: hidden;
        }

        /* line 134, ../sass/mpicker.scss */
        .mPicker-content ul {
          width: 100%;
          text-align: center;
          position: relative;
          z-index: 20;
          list-style: none;
          margin: 0;
          padding: 0;
        }

        /* line 144, ../sass/mpicker.scss */
        .mPicker-content li {
          padding-left: 3%;
          padding-right: 3%;
          height: 36px;
          line-height: 36px;
          overflow: hidden;
          color: #333;
          font-size: .14rem;
          -webkit-transition: all .2s ease-out;
          transition: all .2s ease-out;
        }

        /* line 156, ../sass/mpicker.scss */
        .mPicker-content li.active {
          color: #000;
          -webkit-transform: scale(1.1);
          transform: scale(1.1);
        }

        /* line 162, ../sass/mpicker.scss */
        .mPicker-content.level-2 ul {
          width: 50%;
        }

        /*按钮*/
        /* line 169, ../sass/mpicker.scss */
        .mPicker-confirm,
        .mPicker-cancel {
          color: #333;
          font-size: .14rem;
          width: 50%;
          text-align: center;
          display: inline-block;
          text-decoration: none;
          -webkit-box-sizing: border-box;
          box-sizing: border-box;
        }
        /* line 179, ../sass/mpicker.scss */
        .mPicker-confirm:active, .mPicker-confirm:hover,
        .mPicker-cancel:active,
        .mPicker-cancel:hover {
          background-color: #29799c;
          color: #fff;
        }

        /* line 186, ../sass/mpicker.scss */
        .mPicker-confirm {
          border-right: 1px solid #dbdbdb;
          background: #31b6e7;
          color: #fff;
        }

        /* line 192, ../sass/mpicker.scss */
        .mPicker-input-mask {
          position: absolute;
          top: 0;
          left: 0;
          z-index: 2;
        }

        /* line 199, ../sass/mpicker.scss */
        .mPicker-shadow {
          position: absolute;
          top: 41px;
          bottom: 38px;
          left: 0;
          width: 100%;
          z-index: 999;
          background: linear-gradient(#282828 0, rgba(40, 40, 40, 0) 52%, rgba(40, 40, 40, 0) 48%, #282828 100%);
          background: -webkit-gradient(linear, left bottom, left top, from(#282828), color-stop(0.52, rgba(40, 40, 40, 0)), color-stop(0.48, rgba(40, 40, 40, 0)), to(#282828));
          background: -moz-linear-gradient(#282828 0, rgba(40, 40, 40, 0) 52%, rgba(40, 40, 40, 0) 48%, #282828 100%);
          background: -o-linear-gradient(#282828 0, rgba(40, 40, 40, 0) 52%, rgba(40, 40, 40, 0) 48%, #282828 100%);
          background: -webkit-gradient(linear, 0% 100%, 0% 0%, from(whitesmoke), color-stop(0.48, rgba(245, 245, 245, 0)), color-stop(0.52, rgba(245, 245, 245, 0)), to(whitesmoke));
          pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="wrap page page-current" >
        <div class="con_top" id="conTop" data-header="scroll">
            <div class="top_menu open-panel" data-panel=".panel-left"><span>2</span></div>
            <div class="top_logo"> </div>
            <div class="search" id="search"></div>
       
        </div>
        <!-- 头部结束 -->
        <div class="upload_page">
            <p class="titles_o">作品图片：</p>
            <section class="upload_pic">
                
                <div class="upload_box" id="uploadBox">
                    <!-- <div class="preview_list">
                        <img src="images/1_03.jpg">
                        <a href="javascript:;"></a>
                    </div>  -->
                    <!-- 添加按钮 -->
                    <div class="upload_menu" id="uploadMenu">
                        <input type="file" multiple="true" id="uploadButton" accept="image/png,image/jpeg,image/gif" capture="camera"> 
                    </div>
                </div>                
            </section>
            <dl class="require">
                <dt><a href="javascript:;">查看图片要求</a></dt>
                <dd>
                    <p>至少上传1张作品主图、最多可上传4张细节图。 <br/>
                       支持大小：1-5M<br/>
                       支持格式：JPG/JPEG/PNG<br/>
                       图片要求：<br/>
                       上传图片必须为作品实物图，请保证图片清晰、无噪点、无色差、尽可能真实还原艺术品质感。主图无背景、无透视或非等比拉伸的实物图。<br/>
                       书画类作品：<br/>
                       未装裱画作至少上传1张裸画图片<br/>
                       已装裱画作至少上传1张裸画图片和1张框裱后图片<br/>
                       雕塑类作品：<br/>
                       至少上传3张作品图片，包含作品正面、侧面及细节图各一张
                    </p>
                </dd>
            </dl>    
        </div>  
        <!-- 作品信息 -->
        <ul class="pro_mes">
            <li>作品名称：<input type="text" class="pic_name" value="" placeholder="(必填)"></li>
            <li>艺&nbsp;术&nbsp;家：<input type="text" class="artist" value="" readonly="readonly" placeholder="(必选)"><span>></span></li>
            <li>作品类别：<input type="text" class="leibie" value="" readonly="readonly" placeholder="(必选)"><span>></span></li>
            <li>材&#12288;&#12288;质：<input type="text" class="caizhi" value="" readonly="readonly" placeholder="(必选)"><span>></span></li>
            <li>主&#12288;&#12288;题：<input type="text" class="zhuti" value="" readonly="readonly" placeholder="(必选)"><span>></span></li>
            <li>风&#12288;&#12288;格：<input type="text" class="fengge" value="" readonly="readonly" placeholder="(必选)"><span>></span></li>
            <li>创作年份：<input type="text" class="nianfen" value="" readonly="readonly"  placeholder="(必选)"><span>></span></li>
            <li>是否版画：</li>
            <li>版&#12288;&#12288;号：</li>
            <li>尺&#12288;&#12288;寸：</li>
            <li>是否框裱：</li>
            <li>是否出售：<input type="text" class="chushou" value="" readonly="readonly"  placeholder="(必选)"></li>
            <li>作品价格：<input type="text" class="jiage" value="" placeholder="(必填)"><span>RMB</span></li>
            <li>是否议价：</li>
            <li>作品简介：</li>
            <li>作品标签：</li>
            <li>参加活动：</li>
            <li>协&#12288;&#12288;议：</li>
        </ul>
    </div>
    <!-- 侧边栏 -->
    <!-- 侧边栏结束--> 
</body>
<script src="js/plupload.full.min.js"></script>
<script src="js/zepto.min.js"></script>
<script> 
    function DetailUploader(){}
    DetailUploader.prototype.SIZE = 4;
    DetailUploader.prototype.detailPlupload=function(){
        var that=this;
        var uploader=new plupload.Uploader({
            runtimes:'html5,flash,silverlight,html4',
            browse_button:'uploadButton',
            container:document.getElementById('uploadBox'),
            url:'/seller_manage/editArt/addImg',
            flash_swf_url : 'js/Moxie.swf',
            silverlight_xap_url : 'js/Moxie.xap',
            // multi_selection:false,
            filters : {
                max_file_size : '5mb',
                mime_types: [
                    {title : "Image files", extensions : "jpg,gif,png"},
                    {title : "Zip files", extensions : "zip"}
                ],
                prevent_duplicates : true 
            },
            init:{
                FilesAdded:function(upload,files){
                    if(upload.files.length<=that.SIZE){
                        for(var i=0;i<files.length;i++) {
                            that.previewImage(files[i],function(imgsrc,file){
                                var _that_=that;
                                that.createList(imgsrc,_that_,file, uploader);                  
                            });
                        }
                        
                    }else if((that.SIZE-(upload.files.length-files.length)) >= 0) {
                        for(var i=0;i<(that.SIZE-(upload.files.length-files.length));i++) {
                            that.previewImage(files[i],function(imgsrc,file){
                                var _that_=that;
                                that.createList(imgsrc,_that_,file, uploader);                  
                            });
                        }
                        // 删除超出范围的图片
                        for(var i=(that.SIZE-(upload.files.length-files.length));i<files.length;i++){
                            uploader.removeFile(files[i]);
                        }
                    }       
                    // 上传4张后隐藏上传按钮
                    if(upload.files.length >= that.SIZE) {
                        document.getElementById('uploadMenu').style.display = "none";
                    }
                    uploader.start(); // 启动上传
                    return true;
                }
            }
        });
        uploader.init();
    };
   
    // 图片预览
    DetailUploader.prototype.previewImage = function (file, callback) {
        if (file.type == 'image/gif') {//gif使用FileReader进行预览,因为mOxie.Image只支持jpg和png
            var fr = new mOxie.FileReader();
            fr.onload = function () {
                callback(fr.result, file);
                fr.destroy();
                fr = null;
            }
            fr.readAsDataURL(file.getSource());
        } else {
            var preloader = new mOxie.Image();
            preloader.onload = function () {
                var imgsrc = preloader.type == 'image/jpeg' ? preloader.getAsDataURL('image/jpeg', 80) : preloader.getAsDataURL(); //得到图片src,实质为一个base64编码的数据
                callback(imgsrc, file);
                preloader.destroy();
                preloader = null;
            };
            preloader.load(file.getSource());
        }
    };
//创建图片显示列表
    DetailUploader.prototype.createList=function(imgsrc,_that_, file, uploader){
        var uploadMenu=document.getElementById('uploadMenu');
        var div=document.createElement('div');
        var img=document.createElement('img');
        var a=document.createElement('a');
        div.appendChild(img);
        div.appendChild(a);
        uploadMenu.parentNode.insertBefore(div,uploadMenu);
        div.className=('preview_list');
        img.src = imgsrc;
        img.onload=function(){
            var rect=_that_.Center(div.offsetWidth, div.offsetHeight,img.offsetWidth, img.offsetHeight);
            img.style.width = rect.width + 'px';
            img.style.height = rect.height + 'px';
            img.style.top = rect.top + 'px';
            img.style.left = rect.left + 'px';
        }

        $('.preview_list a').click(function(){
            uploader.removeFile(file);
            $(this).parent().remove();
            document.getElementById('uploadMenu').style.display = "inline-block";
        });
    };

    // 图片居中显示
    DetailUploader.prototype.Center=function(divWidth,divHeight,imgWidth,imgHeight){
        var datas={width:imgWidth,height:imgHeight};
        var ratio=imgWidth/imgHeight;
        var rate=divWidth/divHeight;
        var sx,sy;
        if(ratio>rate){
            datas.height=divHeight;
            datas.width=ratio*divHeight;
            sy=0;
            sx=(divWidth-datas.width)/2;
        }else{
            datas.width=divWidth;
            datas.height=divWidth/ratio;
            sx=0;
            sy=(divHeight-datas.height)/2;
        }
        datas.left=Math.round(sx);
        datas.top=Math.round(sy);
        return datas; 
    };

    function __dealCssEvent(eventNameArr, callback) {
    var events = eventNameArr,
        i, dom = this; // jshint ignore:line

    function fireCallBack(e) {
        /*jshint validthis:true */
        if (e.target !== this) return;
        callback.call(this, e);
        for (i = 0; i < events.length; i++) {
            dom.off(events[i], fireCallBack);
        }
    }
    if (callback) {
        for (i = 0; i < events.length; i++) {
            dom.on(events[i], fireCallBack);
        }
    }
}

//动画结束事件兼容
$.fn.animationEnd = function(callback) {
    __dealCssEvent.call(this, ['webkitAnimationEnd', 'animationend'], callback);
    return this;
};
$.fn.transitionEnd = function(callback) {
    __dealCssEvent.call(this, ['webkitTransitionEnd', 'transitionend'], callback);
    return this;
};
$(function(){
    var mPickerDefaults = {
        display: 'bottom',
        shadow: false,
        level: 1,
        rows: 4,
        Linkage: false,
        dataJson: '',
        height: 36,
        idDefault: false,
        splitStr: ' ',
        isshort : false,
        header: '<div class="mPicker-header"></div>',
        footer: '<div class="mPicker-footer"><a href="javascript:;" class="mPicker-confirm">确定</a><a href="javascript:;" class="mPicker-cancel">取消</a></div>',
        confirm: function() {},
        cancel: function() {}
    };

    var moveStartLock;

    var ulWidth = ['100%', '50%'];

    var $body = $('body');

    var $mask=$('<div class="mPicker-mask hide"></div>');

    var $mPicker=$('<div class="mPicker hide"></div>');

    var lock,timeTouchend;
    /**
     * 添加mPicker容器
     */
    if (!$('.mPicker').length) {
        $body.append($mPicker);
        $mPicker.append($mask);
    }
    /**
     * 阻止默认滚动
     */
    $body.on('touchmove', function(event) {
        if (lock) {
            event.preventDefault();
            event.stopPropagation();
        }
    });
    /**
     * 禁止滚动－－防止滚动选择时页面滚动
     */
    $body.on({
        touchstart: function(event) {
            event.preventDefault();
            lock = 1;
        },
        touchmove: function(event) {
            event.preventDefault();
            //兼容部分手机有时候没有触发touchend
            clearTimeout(timeTouchend);
            timeTouchend = setTimeout(function() {
                lock = 0;
            }, 100);
        },
        touchend: function(event) {
            event.preventDefault();
            lock = 0;
        }
    }, '.mPicker-main');

    function MPicker(ele,options){
        console.log(options);
        if (!ele.length) {
            return false;
        }
        this.container=ele;
        this.mpicker=$('.mPicker');
        this.mask=this.mpicker.find('.mPicker-mask');
        this.options = $.extend({}, mPickerDefaults, options);
        this.init();
        this.event();
        this.container.data('mPicker', this);

    }


    MPicker.prototype={
        //初始化MPicker
        init:function(ele,options){

            /**
             * 根据行数计算居中的位置
             */
            this.middleRowIndex=parseInt(this.options.rows / 2.5);
            //展示方式
            this.disy = this.options.display === 'bottom' ? 'mPicker-bottom down' : 'mPicker-modal';

            this.container.attr('readonly',true);
        },
        //初始化mpicker,根据json渲染html结构,添加遮罩，边框等
        render:function(){
            /**
             *  初始化mpicker,根据json渲染html结构
             *  添加遮罩，边框等
             */
            var listStr;
            var jsonData = [];
            var mainStr;
            var self=this;
            /**
             * 添加 mPicker-main元素
             */
            jsonData.push(self.options.dataJson);
            if (self.options.level === 2) {
                var childStr = getChildJson(self.options.dataJson[0]);
                jsonData.push(childStr);
            }
            listStr = concatHtmlList.call(self,jsonData);
            mainStr = '<div class="mPicker-main '+ self.disy +'" data-pickerId="' + self.pickerId + '">' + self.options.header + '<div class="mPicker-content">' + listStr + '</div><div class="mPicker-shadow"></div>' + self.options.footer + '</div>';
            self.mpicker.append(mainStr);
            /**
             * 设置变量
             */
            self.mpickerMain = self.mpicker.find('.mPicker-main');
            //元素集合
            var $content=self.mpickerMain.find('.mPicker-content');
            var $list=self.mpickerMain.find('.mPicker-list');
            var $listUl=$list.find('ul');
            //var $itemOne=$listUl.eq(0);
            //var $itemTwo=self.options.level === 2?$listUl.eq(1):false;
            //设置多列宽度
            self.options.level > 1 ?$list.width(ulWidth[self.options.level - 1]):false;

            //添加选中的边框
            $list.append('<div class="mPicker-active-box"></div>');
            $list.find('.mPicker-active-box').height(self.options.height);
            /**
             * 设置选中的边框位置
             */
            var activeBoxMarginTop = self.options.rows % 2 === 0 ? -self.options.height - 2 + 'px' : -self.options.height * 0.5 - 2 + 'px';

            $content.find('.mPicker-active-box').css({
                'margin-top': activeBoxMarginTop
            });
            /**
             * 设置内容高度
             */
            $content.height(self.options.height * self.options.rows);
            $list.height(self.options.height * self.options.rows);

        },
        showPicker:function(){
            var self=this;
            self.mpicker.data('object',self);
            //元素集合
            //var $content=this.mpickerMain.find('.mPicker-content');

            //var $listUl=$list.find('ul');
            // var $itemOne=$listUl.eq(0);
            // var $itemTwo=this.options.level === 2?$listUl.eq(1):false;
            self.render();
            var $list=self.mpicker.find('.mPicker-list');
            self.container.focus();
            self.container.blur();
            self.mpicker.removeClass('hide');
            self.mask.removeClass('hide');

            clearTimeout(self.timer);
            self.timer=setTimeout(function() {
                self.mpickerMain.removeClass('down');
            }, 10);
            /**
             * 显示默认值(判断点击确定选择后不再获取默认值)
             */
            if (!self.noFirst && self.options.idDefault) {
                matchDefaultData.call(self);
            }
            /**
             * 获取input的data-id显示选中的元素
             */
            var id = [];
            setTransitionY(self.container, 0);
            $list.each(function(index, ele) {
                var dataVal = self.container.data('id' + (index + 1)) ? self.container.data('id' + (index + 1)) : 0;
                id.push(dataVal);
            });
            //获得选中的元素
            setItemMultiple.call(self,id);
        },
        hidePicker:function(callback){
            var self=this;
            self.mask.addClass('hide');

            if(self.options.display === 'bottom'){
                self.mpicker.find('.mPicker-main').addClass('down').transitionEnd(function() {
                    self.mpicker.addClass('hide');
                    self.mpicker.find('.mPicker-main').remove();
                    if (typeof(callback) === 'function') {
                        callback.call(self);
                    }
                });
                return false;
            }

            self.mpicker.addClass('hide');
            callback.call(self);
            self.mpicker.find('.mPicker-main').remove();
        },
        updateData:function(data){
            var self=this;
            if (!data.length) {
                return;
            }
            self.noFirst = false;
            for (var i = 0; i < self.options.level; i++) {
                self.container.data('id' + (i + 1), 0);
                self.container.data('value' + (i + 1), '');
            }
            self.options.dataJson = data;
            self.mpicker.find('.mPicker-main').remove();
        },
        confirm:function(){
            var self=this;
            var str = '';
            var $list=self.mpicker.find('.mPicker-main').find('.mPicker-list');
            var $listUl=$list.find('ul');
            self.noFirst = true;
            $.each($listUl, function(index, ele) {
                var $active = $(ele).find('.active');
                var splitStr = index === 0 ? '' : self.options.splitStr;
                if ($active.length > 0) {
                    index = index + 1;
                    self.container.data('value' + index, $active.data('value'));
                    self.container.data('id' + index, $active.data('id'));
                    str += splitStr + $active.text();
                }
            });
            self.container.val(str);
            self.hidePicker(self.options.confirm);

        },
        cancel:function(){
            var self=this;
            self.hidePicker(self.options.cancel);
        },
         /**
         *  事件
         *  取消，确定，点击遮罩，列表滑动事件
         */
        event : function() {
            /**
             * 点击打开选择
             */
            var self=this;
            this.container.off('touchstart.container click.container').on('touchstart.container click.container', function(e) {
                e.preventDefault();
                e.stopPropagation();
                self.showPicker();
            });
            //点击确定
            this.mpicker.off('touchstart.confirm click.confirm').on('touchstart.confirm click.confirm','.mPicker-confirm', function(e) {
                e.preventDefault();
                var self=$('.mPicker').data('object');
                self.confirm();
            });

            //点击取消
            this.mpicker.off('touchstart.cancel click.cancel').on('touchstart.cancel click.cancel','.mPicker-cancel', function(e) {
                e.preventDefault();
                var self=$('.mPicker').data('object');
                self.cancel();
            });

            //点击遮罩取消
            this.mpicker.off('touchstart.mask click.mask').on('touchstart.mask click.mask','.mPicker-mask', function(e) {
                e.preventDefault();
                var self=$('.mPicker').data('object');
                if(self.options.shadow){
                    self.cancel();
                }
            });

            //遍历下拉列表
            var startY;
            var curY;
            var moveY;


            this.mpicker.off('touchstart.list mousedown.list').on('touchstart.list mousedown.list','.mPicker-list', function(event) {
                fnTouches(event);

                var $this = $(this).find('ul');

                var tranY = getTranslateY($this);

                startY = getTouches(event).y - tranY;

                changeTime(0, $this);

                moveStartLock=true;
            });

            this.mpicker.off('touchmove.list mousemove.list').on('touchmove.list mousemove.list', '.mPicker-list',function(event) {
                event.preventDefault();
                if(!moveStartLock){
                    return false;
                }
                var self=$('.mPicker').data('object');

                fnTouches(event);

                var translate;

                var $this = $(this).find('ul');

                var listHeight = $this.height();

                var itemHeight = self.options.height * self.options.rows;

                var transMaxY = itemHeight - listHeight - parseInt(self.options.rows / 2) * self.options.height;

                var transMinY = self.middleRowIndex * self.options.height;

                curY = getTouches(event).y;

                moveY = curY - startY;

                translate = Math.round(moveY);
                //过了
                translate = translate > transMinY ? transMinY : translate;
                translate = translate < transMaxY ? transMaxY : translate;
                // console.info(self.options.rows)
                setTransitionY($this, translate);
                //兼容部分手机有时候没有触发touchend
                clearTimeout(self.timeTouchend);
                self.timeTouchend = setTimeout(function() {
                    touchEndFn.call(self,$this);
                }, 100);
            });

            this.mpicker.off('touchend.list mouseup.list').on('touchend.list mouseup.list', '.mPicker-list',function(event) {
                event.preventDefault();
                var self=$('.mPicker').data('object');
                var $this = $(this).find('ul');
                touchEndFn.call(self,$this);

            });
        }
    }
    function getTouches(event) {
        if (event.touches !== undefined) {
            return {
                x : event.touches[0].pageX,
                y : event.touches[0].pageY
            };
        }

        if (event.touches === undefined) {
            if (event.pageX !== undefined) {
                return {
                    x : event.pageX,
                    y : event.pageY
                };
            }
            if (event.pageX === undefined) {
                return {
                    x : event.clientX,
                    y : event.clientY
                };
            }
        }
    }


    /**
     *  滑动结束执行函数
     *  ele:对应的list==>ul
     *  如果是联动，则更新相应的list html
     */
    function touchEndFn(ele) {
        clearTimeout(this.timeTouchend);
        var result = setActiveItem.call(this,ele);

        var resultId = result.target.data('id');

        var itemIndex = this.mpicker.find('.mPicker-list ul').index(ele);
        // this.lock=0;
        //点第一个联动
        if (this.options.Linkage && itemIndex === 0) {
            refreshItemTwo.call(this,resultId);
        }
        //回调函数
        // callbackFnName[itemIndex].call(ele, result);

        changeTime(400, ele);

        moveStartLock=false;
    }

    /**
     *  第一次打开匹配默认值
     */
    function matchDefaultData() {
        var self=this;
        var inputVal = this.container.val().split(this.options.splitStr);
        var defaultId = [];
        var defaultValue = [];
        var dataLevel2;
        var hasLevel2;
        //遍历获取id
        var nameEach = function(data, index) {
            $.each(data, function(key, val) {
                if (val.name == inputVal[index]) {
                    defaultId[index] = key;
                    defaultValue[index] = val.value;
                    self.container.data('value' + (index + 1), defaultValue[index]);
                    self.container.data('id' + (index + 1), defaultId[index]);
                    return false;
                }
            });
        };
        if (typeof(inputVal) !== 'object' || !inputVal.length || !self.mpicker.find('.mPicker-main')) {
            return;
        }

        //将name值默认匹配成id，一旦匹配就跳出循环，多个匹配取第一个
        //匹配一级
        nameEach(this.options.dataJson, 0);
        //匹配二级
        dataLevel2 = this.options.Linkage ? this.options.dataJson[defaultId[0]] : this.options.dataJson[0];

        if (this.options.Linkage && this.options.level === 2 && defaultId[0] && inputVal.length > 1) {
            hasLevel2 = 1;
        }

        if (!this.options.Linkage && this.options.level === 2 && inputVal.length > 1) {
            hasLevel2 = 1;
        }

        if (hasLevel2) {
            dataLevel2 = getChildJson(dataLevel2);
            nameEach(dataLevel2, 1);
        }

    }
    /**
     *  滑动结束，设置transtion值，返回当前选中的li index和元素
     *  obj:滑动的元素
     *  val:可有可没有。可传入data-id或不传
     */
    function setActiveItem(obj, val) {
        var result;
        var y = Math.round((getTranslateY(obj) / this.options.height));
        //得到选中的index
        var index = typeof(val) === 'number' ? obj.find('li').index(obj.find('li[data-id="' + val + '"]')) : this.middleRowIndex - y;

        var y2 = -this.options.height * (index - this.middleRowIndex);
        setTransitionY(obj, y2);
        //添加选中样式
        obj.find('li').eq(index).addClass('active').siblings('li').removeClass('active');

        result = {
            target: obj.find('li').eq(index),
            index: index
        };
        return result;
    }
    /**
     *  传入第一级index，更新第二级html（联动的情况下）
     */
    function refreshItemTwo(index) {
        //兼容不存在child
        var $itemTwo=this.mpicker.find('.mPicker-list ul').eq(1);
        var data = getChildJson(this.options.dataJson[index]);
        if (this.options.level === 2) {
            var str = concatHtmlItem.call(this,data);
            $itemTwo.html(str);
            setActiveItem.call(this,$itemTwo, 0);
        }
    }
    /**
     *  传入数组，设置多级html
     *  index:数组
     */
    function setItemMultiple(index) {
        var $item=this.mpicker.find('.mPicker-list ul');
        var index1 = index[0] ? index[0] : 0;
        var index2 = index[1] ? index[1] : 0;

        if (this.options.Linkage) {
            refreshItemTwo.call(this,index1);
        }
        setActiveItem.call(this,$item.eq(0), index1);

        if (this.options.level === 2) {
            setActiveItem.call(this,$item.eq(1), index2);
        }
    }

    /**
     *  传入json,判断返回json,child
     *  兼容不存在child报错的情况
     */
    function getChildJson(data) {
        if (!data) {
            return [];
        }
        var result = ({}).hasOwnProperty.call(data, 'child') ? data.child : [];
        return result;
    }
    /**
     *  传入json拼接html，只有li级别
     */
    function concatHtmlItem(data) {
        var str = '';
        var self=this;
        $.each(data, function(index, val) {
            var name = self.options.isshort ? val.shortName : val.name;
            str += '<li data-value="' + val.value + '" data-id="' + index + '">' + name + '</li>';
        });
        return str;
    }
    /**
     *  传入li html 拼接ul
     */
    function concatHtmlList(data) {
        var html = '';
        for (var i = 0; i < data.length; i++) {
            var itemStr = concatHtmlItem.call(this,data[i]);
            html += '<div class="mPicker-list"><ul>' + itemStr + '</ul></div>';
        }
        return html;
    }
    /**
     *  设置运动时间
     */
    function changeTime(times, obj) {
        obj.css({
            '-webkit-transition-duration': times + 'ms',
            'transition-duration': times + 'ms'
        });
    }
    /**
     *  touches兼容
     */
    function fnTouches(e) {
        if (!e.touches) {
            e.touches = e.originalEvent.touches;
        }
    }
    /**
     *  设置translateY
     */
    function setTransitionY(obj, y) {
        obj.css({
            "-webkit-transform": 'translateY(' + y + 'px)',
            transform: 'translateY(' + y + 'px)'
        });
    }
    /**
     *  获取translateY
     */
    function getTranslateY(obj) {
        var transZRegex = /\.*translateY\((.*)px\)/i;
        var result;
        if (obj[0].style.WebkitTransform) {
            result = parseInt(transZRegex.exec(obj[0].style.WebkitTransform)[1]);
        } else if (obj[0].style.transform) {
            result = parseInt(transZRegex.exec(obj[0].style.transforms)[1]);
        }
        return result;
    }

     $.fn.mPicker = function(options) {
       return this.each(function () {
            new MPicker($(this), options);
        });
    };

}());

    var detail_plupload=new DetailUploader();
    detail_plupload.detailPlupload();

    var data=[{'name':'未售'},{'name':'出售'},{'name':'已售'}];
    window.dataJson = data;

    $('.leibie').mPicker({
            level:1,
            dataJson:dataJson,
            Linkage:false,
            rows:6,
            idDefault:true,
            // header:'<div class="mPicker-header">单级选择</div>',
            confirm:function(){
                //console.info($('.select-value3').data('id1'));
            },
            cancel:function(){
                //console.info($('.select-value3').data('id1'));
            }
        })

</script>
</html>