<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>艺术品上传页面</title>
    <link rel="stylesheet" type="text/css" href="style/basic.css">
    <link rel="stylesheet" type="text/css" href="style/index.css">
    <meta name="Keywords" content="艺术品上传页面">
    <meta name="description" content="艺术品上传页面">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <meta property="qc:admins" content="2275617726564116375">
    <meta http-equiv="Cache-Control" content="no-transform ">
    <meta name="applicable-device" content="mobile">
    <meta name="viewport" content="minimal-ui=yes,width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
    <style>
        ::-webkit-scrollbar {
            width: 0px;
            height:0px;
        }

        img {
            border: none;
        }

        .upload_page{
            padding:.5rem 0 0 .17rem;            
        }

        .upload_page p{
            font:400 .12rem/.29rem "黑体";
            padding-top:.12rem ;
        }

        .upload_box{
            white-space: nowrap; 
            overflow-x: auto;
            font-size: 0;
            -webkit-overflow-scrolling: touch;
            overflow-scrolling: touch;

        }

        .preview_list,.upload_menu{
            display: inline-block;
            vertical-align: top;
            position: relative; 
            width: 0.9rem;
            height:0.9rem;
        }

        .preview_list{
            overflow: hidden;
            margin-right: 0.06rem;
            z-index:10;
        }

        .preview_list img{
            position: absolute;
        }

        .preview_list a{
            display: block;
            width: .25rem;
            height:.25rem;
            position: absolute;
            right:0.03rem;
            top:0.04rem;
            background:url(images/result.png) no-repeat 0 -1.55rem;
            background-size: 1.485rem 2.12rem;
            z-index:11;
        }

        .upload_menu{
            background: url(../images/upload.jpg)no-repeat;
            background-size:0.9rem 0.9rem;
        }

        .upload_menu input{
            width: 100%;
            height: 100%;
            opacity: 0;
        }

    </style>
</head>
<body>
    <div class="wrap page page-current" >
        <div class="con_top" id="conTop" data-header="scroll">
            <div class="top_menu open-panel" data-panel=".panel-left"><span>2</span></div>
            <div class="top_logo"> </div>
            <div class="search" id="search"></div>
       
        </div>
        <!-- 头部结束 -->
        <div class="upload_page">
            <p>作品图片：</p>
            <section class="upload_pic">
                
                <div class="upload_box" id="uploadBox">
                    <!-- <div class="preview_list">
                        <img src="images/1_03.jpg">
                        <a href="javascript:;"></a>
                    </div>   
                    <div class="preview_list">
                        <img src="images/02.jpg">
                        <a href="javascript:;"></a>
                    </div>
                    <div class="preview_list">
                        <img src="images/05.jpg">
                        <a href="javascript:;"></a>
                    </div>
                    <div class="preview_list">
                        <img src="images/07.jpg">
                        <a href="javascript:;"></a>
                    </div> -->
                    <!-- 添加按钮 -->
                    <div class="upload_menu" id="uploadMenu">
                        <!-- <input type="file" accept="image/*" id="uploadButton"> -->
                        <input type="file" multiple="true" id="uploadButton" accept="image/png,image/jpeg,image/gif" capture="camera"> 
                    </div>
                </div>                
            </section>
        </div>  

    </div>
  
    <!-- 侧边栏 -->
    <!-- 侧边栏结束-->  
</body>
<!-- <script src="js/artworkplupload.js"></script> -->
<!-- <script src="js/detail_picture_upload.js"></script> -->
<script src="js/plupload.full.min.js"></script>
<script src="js/zepto.min.js"></script>
<script> 
    function DetailUploader(){}
    DetailUploader.prototype.SIZE = 4;
    DetailUploader.prototype.detailPlupload=function(){
        var that=this;
        var uploader=new plupload.Uploader({
            runtimes:'html5,flash,silverlight,html4',
            browse_button:'uploadButton',
            container:document.getElementById('uploadBox'),
            url:'/seller_manage/editArt/addImg',
            flash_swf_url : 'js/Moxie.swf',
            silverlight_xap_url : 'js/Moxie.xap',
            // multi_selection:false,
            filters : {
                max_file_size : '5mb',
                mime_types: [
                    {title : "Image files", extensions : "jpg,gif,png"},
                    {title : "Zip files", extensions : "zip"}
                ],
                prevent_duplicates : true 
            },
            init:{
                FilesAdded:function(upload,files){
                    if(upload.files.length<=that.SIZE){
                        for(var i=0;i<files.length;i++) {
                            that.previewImage(files[i],function(imgsrc,file){
                                var _that_=that;
                                that.createList(imgsrc,_that_,file, uploader);                  
                            });
                        }
                        
                    }else if((that.SIZE-(upload.files.length-files.length)) >= 0) {
                        for(var i=0;i<(that.SIZE-(upload.files.length-files.length));i++) {
                            that.previewImage(files[i],function(imgsrc,file){
                                var _that_=that;
                                that.createList(imgsrc,_that_,file, uploader);                  
                            });
                        }
                        // 删除超出范围的图片
                        for(var i=(that.SIZE-(upload.files.length-files.length));i<files.length;i++){
                            uploader.removeFile(files[i]);
                        }
                    }       
                    // 上传4张后隐藏上传按钮
                    if(upload.files.length >= that.SIZE) {
                        document.getElementById('uploadMenu').style.display = "none";
                    }
                    uploader.start(); // 启动上传
                    return true;
                }
            }
        });
        uploader.init();
    };
   
    // 图片预览
    DetailUploader.prototype.previewImage = function (file, callback) {
        if (file.type == 'image/gif') {//gif使用FileReader进行预览,因为mOxie.Image只支持jpg和png
            var fr = new mOxie.FileReader();
            fr.onload = function () {
                callback(fr.result, file);
                fr.destroy();
                fr = null;
            }
            fr.readAsDataURL(file.getSource());
        } else {
            var preloader = new mOxie.Image();
            preloader.onload = function () {
                var imgsrc = preloader.type == 'image/jpeg' ? preloader.getAsDataURL('image/jpeg', 80) : preloader.getAsDataURL(); //得到图片src,实质为一个base64编码的数据
                callback(imgsrc, file);
                preloader.destroy();
                preloader = null;
            };
            preloader.load(file.getSource());
        }
    };
//创建图片显示列表
    DetailUploader.prototype.createList=function(imgsrc,_that_, file, uploader){
        var uploadMenu=document.getElementById('uploadMenu');
        var div=document.createElement('div');
        var img=document.createElement('img');
        var a=document.createElement('a');
        div.appendChild(img);
        div.appendChild(a);
        uploadMenu.parentNode.insertBefore(div,uploadMenu);
        div.className=('preview_list');
        img.src = imgsrc;
        img.onload=function(){
            var rect=_that_.Center(div.offsetWidth, div.offsetHeight,img.offsetWidth, img.offsetHeight);
            img.style.width = rect.width + 'px';
            img.style.height = rect.height + 'px';
            img.style.top = rect.top + 'px';
            img.style.left = rect.left + 'px';
        }

        $('.preview_list a').click(function(){
            uploader.removeFile(file);
            $(this).parent().remove();
            document.getElementById('uploadMenu').style.display = "inline-block";
        });
    };

    // 图片居中显示
    DetailUploader.prototype.Center=function(divWidth,divHeight,imgWidth,imgHeight){
        var datas={width:imgWidth,height:imgHeight};
        var ratio=imgWidth/imgHeight;
        var rate=divWidth/divHeight;
        var sx,sy;
        if(ratio>rate){
            datas.height=divHeight;
            datas.width=ratio*divHeight;
            sy=0;
            sx=(divWidth-datas.width)/2;
        }else{
            datas.width=divWidth;
            datas.height=divWidth/ratio;
            sx=0;
            sy=(divHeight-datas.height)/2;
        }
        datas.left=Math.round(sx);
        datas.top=Math.round(sy);
        return datas; 
    };

    var detail_plupload=new DetailUploader();
    detail_plupload.detailPlupload();



</script>
</html>