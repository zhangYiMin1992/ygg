<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <link rel="stylesheet" type="text/css" href="http://www.artgogo.com/zhangyimin_test/style/basic.css">
    <link rel="stylesheet" type="text/css" href="http://www.artgogo.com/zhangyimin_test/style/login.css">
    <meta name="Keywords" content="登陆页面">
    <meta name="description" content="登陆页面">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <meta property="qc:admins" content="2275617726564116375">
    <meta http-equiv="Cache-Control" content="no-transform ">
    <meta name="applicable-device" content="mobile">
    <meta name="viewport" content="minimal-ui=yes,width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
</head>

<body>
    <!--登陆页面-->
    <div id="login" class="wrap page" style="">
        <!-- 头部 -->
        <div class="top">
            <div class="con_top clearfix">
                <div class="top_menu"><span>2</span></div>
                <div class="top_logo"> </div>
                <div class="cancel" id="loginCancel">取消</div>
            </div>
        </div>
        <div class="login_contant">
            <div class="line_font">
                <div class="waterline"></div>
                <div class="font1">LOGIN</div>
            </div>
            <!-- 登陆框部分 -->
            <div class="login_box" id="loginBox">
                <input type="tel" id="loginPhone" placeholder="手机号" maxlength="11">
                <input id="loginPwd" name="customerPwd" class="on password" maxlength="16" type="password" placeholder="密码">
                <a class="login_menu " id="login_menu" href="javascript:void(0);">登录</a>
                <div class="login_bottom"> <span id='registerBtn'>立即注册</span> <span>忘记密码</span> </div>
                <p>“欢迎，一不小心进了艺术圈儿”</p>
            </div>
        </div>
    </div>
    <!--注册页面-->
    <div id="register" class="hide wrap page" style="display: none">
        <div class="top">
            <div class="con_top clearfix">
                <div class="top_menu"><span>2</span></div>
                <div class="top_logo"> </div>
                <div class="cancel" id="loginCancel">取消</div>
            </div>
        </div>
        <div class="login_contant">
            <div class="line_font">
                <div class="waterline"></div>
                <div class="font2">CREATE YOUR ACCOUNT</div>
            </div>
            <!-- 登陆框部分 -->
            <div class="login_box">
                <input type="tel" id="registerPhone" placeholder="手机号" maxlength="11">
                <input id="pwd" name="customerPwd" maxlength="16" type="password" placeholder="请输入密码">
                <input id="pwdAgain" name="customerPwd" maxlength="16" type="password" placeholder="请再次输入密码">
                <div class="inline">
                    <input type="text" id="mobile_code" name="mobile_code" class="on long" placeholder="请输入手机验证码">
                    <input type="button" value="获取验证码" id="get_mobile_code" class="on short">
                </div>
                <dl>
                    <dt id="agree"></dt>
                    <dd>同意 <a href="javascript:;">艺高高服务协议</a></dd>
                </dl>
                <a class="login_menu " id="register_menu" href="javascript:;">立刻注册</a>
                <p><span id="pleaseLogin">有账号了？请登录</span></p>
            </div>
        </div>
    </div>
    <div class="panel-overlay"></div>
    <div class="left_sidebar" id="leftSidebar">
        <div class="account_area">
            <div class="account_img"></div>
            <div class="account_name">诗意方</div>
        </div>
        <dl>
            <dt class="list_bck1">中国爱艺术</dt>
        </dl>
        <dl>
            <dt class="list_bck2">万人展</dt>
        </dl>
        <dl class="select">
            <dt class="list_bck3">发现艺术</dt>
            <dd> <a href="javascript:;"> | 艺术介入服务</a> <a href="javascript:;"> | 艺术能量供应</a> </dd>
        </dl>
        <dl class="select">
            <dt class="list_bck4">艺术x品牌</dt>
            <dd> <a href="javascript:;"> | 艺术介入服务</a> <a href="javascript:;"> | 艺术能量供应</a> </dd>
        </dl>
        <dl class="select">
            <dt class="list_bck5">艺术品</dt>
            <dd> <a href="javascript:;"> | 艺术介入服务</a> <a href="javascript:;"> | 艺术能量供应</a> </dd>
        </dl>
        <dl class="select">
            <dt class="list_bck6">艺术家</dt>
            <dd> <a href="javascript:;"> | 艺术介入服务</a> <a href="javascript:;"> | 艺术能量供应</a> </dd>
        </dl>
        <dl>
            <dt class="list_bck7">关于我们</dt>
        </dl>
        <dl class="noline">
            <dt class="list_bck8">个人中心<span>2</span></dt>
        </dl>
    </div>
    <div class="km-dialog km-dialog-ios7 km-dialog-alert" style=" ">
        <div class="km-dialog-content">你输入的密码和账号不匹配</div>
        <div class="km-dialog-buttons"><span class="km-dialog-btn" data-idx="alert0">确定</span> </div>
    </div>
    <div class="km-dialog-mask"></div>
    <span class="regist_phone_dialog"></span>
</body>

</html>
<script type="text/javascript" src='http://www.artgogo.com/zhangyimin_test/js/basic.js'></script>
<script type="text/javascript" src='http://m.artgogo.com/js/rsa/RSA.js'></script>
<script type="text/javascript" src='http://m.artgogo.com/js/rsa/BigInt.js'></script>
<script type="text/javascript" src='http://m.artgogo.com/js/rsa/Barrett.js'></script>
<script type="text/javascript">
var _2bind = "<!--{eval echo $_2bind;}-->";
// 动画兼容处理
var transitionEnd = function(style) {
    var transEndEventNames = {
        WebkitTransition: 'webkitTransitionEnd',
        MozTransition: 'transitionend',
        OTransition: 'oTransitionEnd otransitionend',
        transition: 'transitionend'
    }
    for (var name in transEndEventNames) {
        if (typeof style[name] === "string") {
            return transEndEventNames[name]
        }
    }
};
//注册页面手机号码验证
var timer_dialog = null;
//遮罩弹框提醒
function maskShow(index) {
    timer_dialog = setTimeout(function() {
        $('.regist_phone_dialog').html(message[index]);
        $('.regist_phone_dialog,.km-dialog-mask').css('display', 'block');
        setTimeout(function() {
            $('.regist_phone_dialog,.km-dialog-mask').css('display', 'none');
        }, 2000);
    }, 100);
}

/**
 * 登录
 */
$(function(){
    //检测是否登录过
    $.ajax({
        async: false,
        type: "POST",
        url: "/201405/checkusername.php?random=" + Math.random(),
        success: function(json) {
            if (json['login'] === "true") {
                window.location.href = "/newwap/usercenter/index.php";
            }
        }
    });
    $('#loginPhone').get(0).onkeyup = function(event) {
            var e = event || window.event;
            var code=e.keyCode;
            var isInput=(code>=48 && code<=57) || (code>=96 && code <=105) || code==37 || code==39 || code==8;
            !isInput &&  (this.value = this.value.replace(/[^\d]+/g,''));
        }
        //点击登录按钮
    $('#login_menu').click(function() {
        var name = $.trim($('#loginPhone').val());
        var rember = 'checked';
        var psw = $.trim($("#loginPwd").val());
        if (!$.YGG.regExp.cellPhone.test(name)) {
            maskShow(2);
            return;
        } else if ($.YGG.regExp.cellPhone.test(name) && psw == '') {
            maskShow(8);
            return;
        }
        var rember = 'checked';
        var psw = $("#loginPwd").val();
        var rsa_n = "DEF1F0446302D3F53875A97062335A7C392005174775B3F2879A97F4F2E2648C549882D379FE48E0B4A6FC795318959D729F2782AC97B793AFEC97E458A01CBF63C273DBBE773E30D91DF6D977907198D3420353167A9CDDB186844C666E00FF1D0388FB917EF9325678CFD4674EF6C7CA5F4047570C44B1C1C4FE4EA31BEE67";
        setMaxDigits(131); //131 => n的十六进制位数/2+3
        var key = new RSAKeyPair("010001", '', rsa_n); //010001 => e的十六进制
        var password = encryptedString(key, pwd); //不支持汉字
        //        console.log(password);
        $.ajax({
            type: "POST",
            url: '/newwap/usercenter/login_ajax.php',
            data: "login_username=" + name + "&login_pass=" + password + "&type=login&randowm=" + Math.random() + "&rember=" + rember,
            success: function(data) {
                if (data['data'] == "true") {
                    // alert('登录成功');
                    window.location.href = '/newwap/usercenter/artwork_add.php';
                } else {
                    $('.km-dialog-mask,.km-dialog').css('display', 'block');
                    return;
                }
            }
        });
    });
    //隐藏弹出层
    $('.km-dialog-buttons span').click(function() {
        $('.km-dialog-mask,.km-dialog').css('display', 'none');
    });
})
/**
 * 注册
 */
$(function() {
    $('#registerBtn').click(function() {
        $('#login').hide();
        $('#register').show();
    });
    $('#pleaseLogin,#registerCancel').click(function() {
        $('#login').show();
        $('#register').hide();
    });

    //点击菜单键
    $('.top_menu').click(function() {
        $('body').addClass('with-panel-left-reveal');
        $('.left_sidebar').css('display', 'block');
        $('.left_sidebar').addClass('active');
    });
    // 点击隐藏左侧边栏
    $('.panel-overlay').click(function() {
        $('.left_sidebar').removeClass('active');
        $('body').removeClass('with-panel-left-reveal').addClass('panel-closing');
    });
    var siderbar = function() {
            if ($('.left_sidebar').hasClass('active')) {
                $('.panel-overlay').css('display', 'block');
                return;
            }
            $('.left_sidebar,.panel-overlay').css('display', 'none');
            $('body').removeClass('panel-closing');
        }
        //监听动画是否完成
    $(".page").get(0).addEventListener(transitionEnd($('.page').get(0).style), siderbar);
    $(".page").get(1).addEventListener(transitionEnd($('.page').get(1).style), siderbar);

    // 侧边栏菜单
    $('#leftSidebar .select dt').click(function() {
        if ($(this).parent().attr('class') != 'select on') {
            $(this).parent().addClass('on');
        } else {
            $(this).parent().removeClass('on');
        }
        var $dd = $(this).siblings();
        $dd.slideToggle(100);
    });
    var message = ['手机号码格式不正确，请重新输入', '此手机号已经注册', '请输入正确的手机号码', '验证码已发送至手机',
        '密码长度为6-16位数字字母符号组合', '密码输入不一致', '注册失败，请检查填写信息是否准确', '验证码不正确',
        '请输入密码', '请再次输入密码', '请输入验证码', '需同意服务条款才能注册，谢谢您的支持！'
    ];
    var keycode = ['48', '49', '50', '51', '52', '53', '54', '55', '56', '57', '8', '32', '13', '37', '39', '96', '97', '98', '99', '100', '101', '102', '103', '104', '105'];
    var isarray = [false, false, false, false, false];
    var mobile = $("#registerPhone").val();
    //验证号码格式是否错误
    var onOff = '';
    $('#registerPhone').get(0).onblur = function() {
        if (!$.YGG.regExp.cellPhone.test(this.value) && $("#registerPhone").val() != '') {
            maskShow(2);
            isarray[0] = false;
            onOff = 'false1'; //代表号码不正确
        }
    }
    $('#registerPhone').get(0).onkeyup = function(event) {

        var event = event || window.event;
        for (var i = 0, len = keycode.length; i < len; i++) {
            if (event.KeyCode == keycode[i]) {
                break; //跳出循环
            }
            if (i == len) {
                this.value = '';
                isarray[0] = false;
            }
        }
    }
    if ($("#registerPhone").val() == '') {
        $('#get_mobile_code').val('获取验证码');
        isarray[0] = false;
    }
    var phoneLen = $('#registerPhone').val().length;
    if (phoneLen == 11) {
        if ($.YGG.regExp.cellPhone.test(this.value)) {
            $.ajax({
                type: "POST",
                dataType: "json",
                url: "newwap/user/userExist?username=" + $('#registerPhone').val(),
                success: function(json) {
                    if (json.isExist) { //代表号码已经注册了
                        isarray[0] = false;
                        onOff = 'false2';
                    } else {
                        isarray[0] = true;
                        onOff = true;
                    }
                }
            });
        }
    } else {
        return
    }

    //短信发送
    $('#get_mobile_code').click(function() {
        if (onOff == true) {
            var mobile = $('#registerPhone').val();
            $.ajax({
                type: 'GET',
                dataType: 'json',
                url: "/newwap/message/sendVerificationCode?mobile=" + mobile,
                success: function(json) {
                    if (json.isSuccess) {
                        setTimeout(function() {
                            $('#get_mobile_code').val('已发送');
                            setTimeout(function() {
                                $('#get_mobile_code').val('获取验证码');
                            }, 1800000);
                        }, 100);
                        maskShow(3);
                    } else {
                        maskShow(2);
                    }
                }
            });
        } else if (onOff == 'false2') {
            maskShow(1);
        } else if ($("#registerPhone").val() == '' || onOff == 'false1') {
            maskShow(2);
        }
    });
    //验证验证码
    var isverificationCode = '';
    $('#mobile_code').get(0).onkeyup = function() {
        var len = $('#mobile_code').val().length;
        if (len == 6) {
            $.ajax({
                type: "POST",
                dataType: "json",
                url: "/newwap/message/verifyVerificationCode?verificationCode=" + mobile_code,
                success: function(json) {
                    if (json.isSuccess) {
                        isverificationCode = true; //验证码正确 
                    } else {
                        isverificationCode = false; //验证码错误
                    }
                }
            });
        } else {
            return;
        }
    }

    //点击立即注册按钮
    $('#register_menu').click(function() {

        if (onOff == true) {
            //验证密码
            var pass = $("#pwd").val();
            pass = $.trim(pass);
            if ($('#pwd').val() == '') {
                maskShow(8);
                isarray[1] = false;
                return;
            } else if ($('#pwd').val() != '' && $('#pwd').val().length > 16 || $('#pwd').val().length < 6) {
                maskShow(4);
                isarray[1] = false;
                return;
            } else {
                isarray[1] = true;
            }
            //验证密码是否一致
            if ($('#pwdAgain').val() == '') {
                maskShow(9);
                isarray[2] = false;
                return;
            } else if ($('#pwdAgain').val() != $('#pwd').val()) {
                maskShow(5);
                isarray[2] = false;
                return;
            } else if ($('#pwdAgain').val() === $('#pwd').val()) {
                isarray[2] = true;
            }
            //验证验证码
            var mobile_code = $('#mobile_code').val();
            mobile_code = $.trim(mobile_code);
            if ($('#mobile_code').val() == "") {
                maskShow(10);
                isarray[3] = false;
                return;
            } else if (isverificationCode == true) {
                isarray[3] = true;
                // 检查是否同意协议
                if ($('#agree').attr('class') != 'agree_img') {
                    maskShow(11);
                    isarray[4] = false;
                } else {
                    isarray[4] = true;
                }
            } else {
                maskShow(7);
                isarray[3] = false;
            }

            var rsa_n = "DEF1F0446302D3F53875A97062335A7C392005174775B3F2879A97F4F2E2648C549882D379FE48E0B4A6FC795318959D729F2782AC97B793AFEC97E458A01CBF63C273DBBE773E30D91DF6D977907198D3420353167A9CDDB186844C666E00FF1D0388FB917EF9325678CFD4674EF6C7CA5F4047570C44B1C1C4FE4EA31BEE67";
            setMaxDigits(131); //131 => n的十六进制位数/2+3
            var key = new RSAKeyPair("010001", '', rsa_n); //010001 => e的十六进制
            var password = encryptedString(key, pass); //不支持汉字

            if (isarray[0] == true && isarray[1] == true && isarray[2] == true && isarray[3] == true && isarray[4] == true) {
                $.ajax({
                    type: "POST",
                    dataType: "json",
                    url: 'newwap/user/userSignup',
                    data: {
                        username: $("#registerPhone").val(),
                        password: $("#pwd").val(),
                        verificationCode: mobile_code
                    },
                    success: function(json) {
                        if (json.isSuccess) {
                            alert('成功');
                            // window.location.href="/newwap/usercenter/index.php"; 
                        } else {
                            maskShow(6);
                        }
                    }
                });
            }
        } else if (onOff == 'false2') {
            maskShow(1);
        } else if ($("#registerPhone").val() == '' || onOff == 'false1') {
            maskShow(2);
        }
    });
    // 检查是否同意协议
    $('#agree').click(function() {
        if ($(this).attr('class') != 'agree_img') {
            $(this).addClass('agree_img');
        } else {
            $(this).removeAttr('class');
        }
    });

});
</script>
