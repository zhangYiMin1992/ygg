<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>艺术品列表</title>
    <link rel="stylesheet" type="text/css" href="style/art_list.css">
    <link rel="stylesheet" type="text/css" href="style/basic.css">
    <meta name="Keywords" content="艺术品列表">
    <meta name="description" content="艺术品列表">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <meta property="qc:admins" content="2275617726564116375">
    <meta http-equiv="Cache-Control" content="no-transform ">
    <meta name="applicable-device" content="mobile">
    <meta name="viewport" content="minimal-ui=yes,width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
  <style>
        .loading{
            width:100%;
            height:50px;
            line-height: 50px;
            text-align: center;
            color:#666;
            font-size: 12px;
        }
        .list_menu dl dd{
            max-height: 5rem;
            overflow-y: scroll;
        }
    </style>
</head>

<body>
    <div class="wrap page page-current">
        <div class="con_top" id="conTop" data-header="scroll">
            <div class="top_menu open-panel" data-panel=".panel-left"><span>2</span></div>
            <div class="top_logo"> </div>
            <div class="search" id="search"></div>
        </div>
            <!-- 分类列表 -->
            <div class="list_menu">
                 <dl class="select_one" >
                    <dt>类别</dt>
                    <dd>
                        <a href="javascript:;">全部</a>
                        <a href="javascript:;">版画</a>
                        <a href="javascript:;">国画</a> 
                        <a href="javascript:;">油画</a>
                        <a href="javascript:;">丙烯</a>
                        <a href="javascript:;">雕塑</a>
                        <a href="javascript:;">素描</a>
                        <a href="javascript:;">水彩</a>
                        <a href="javascript:;">摄影</a>
                        <a href="javascript:;">装置</a>
                        <a href="javascript:;">插画</a>
                        <a href="javascript:;">数码绘图</a>
                        <a href="javascript:;">综合材料</a>
                        <a href="javascript:;">艺术衍生品</a>
                        <a href="javascript:;">漆画</a>
                        <a href="javascript:;">民间艺术</a>
                        <a href="javascript:;">其他</a>
                        
                    </dd>
                </dl>
                <dl class="select_one">
                    <dt>价格</dt>
                    <dd>
                        <a href="javascript:;" data-code="">全部</a>
                        <a href="javascript:;" data-code="10000-30000">1万元～3万元</a>
                        <a href="javascript:;" data-code="<1000">1000元以下</a>
                        <a href="javascript:;" data-code="30000-50000">3万～5万</a>
                        <a href="javascript:;" data-code="1000-5000">1000～5000元</a>
                        <a href="javascript:;" data-code="50000-100000">5万元～10万元</a>
                        <a href="javascript:;" data-code="5000-10000">5000～1万元</a>
                        <a href="javascript:;" data-code=">100000">10万元以上</a>
                    </dd>
                </dl>
                <dl class="select_one">
                    <dt>排序</dt>
                    <dd>
                        <a href="javascript:;" data-code="default">默认排序</a>
                        <a href="javascript:;" data-code="publish_date_desc">价格由低到高</a>
                        <a href="javascript:;" data-code="price_asc">最新发布</a>
                        <a href="javascript:;" data-code="price_desc">价格由高到低</a>
                    </dd>
                </dl>
                <dl class="screen">
                    <dt>筛选</dt>
                    <dd>
                        <div class="screen_res">
                            <span>筛选结果:</span>
                            <span class="screen_str">确定</span>
                            <span class="cancel_screen">取消</span>
                        </div>
                        <div class="clearfix screen_list sell">
                            <P>销售</P>
                            <a href="javascript:;">全部</a>
                            <a href="javascript:;">未售</a>
                            <a href="javascript:;">已售</a>
                            <a href="javascript:;">可议价</a>
                            <a href="javascript:;">非卖品</a>
                        </div>
                        <div class="clearfix screen_list size">
                            <P>尺寸</P>
                            <a href="javascript:;" data-code="">全部</a>
                            <a href="javascript:;" data-code="80-120cm">80～120cm</a>
                            <a href="javascript:;" data-code="0-20cm">0～20cm</a>
                            <a href="javascript:;" data-code="120-150cm">120～150cm</a>
                            <a href="javascript:;" data-code="20-50cm">20～50cm</a>
                            <a href="javascript:;" data-code="150-200cm">150～200cm</a>
                            <a href="javascript:;" data-code="50-80cm">50～80cm</a>
                            <a href="javascript:;" data-code=">200cm">200cm以上</a>
                        </div>
                        <div class="clearfix screen_list year">
                            <P>年份</P>
                            <a href="javascript:;" data-code="">全部</a>
                            <a href="javascript:;" data-code="five_year">5年以内</a>
                            <a href="javascript:;" data-code="2017">2017年</a>
                            <a href="javascript:;" data-code="2010-2013">2010～2013年</a>
                            <a href="javascript:;" data-code="2016">2016年</a>
                            <a href="javascript:;" data-code="2000-2009">2000～2009年</a>
                            <a href="javascript:;" data-code="2015">2015年</a>
                            <a href="javascript:;" data-code="1990-1999">1990～1999年</a>
                            <a href="javascript:;" data-code="2014">2014年</a>
                            <a href="javascript:;" data-code="1980-1989">1980～1989年</a>
                            <a href="javascript:;" data-code="2013">2013年</a>
                            <a href="javascript:;" data-code="<1980">1980以前</a>
                        </div>
                    </dd>
                </dl>
            </div>
        <!-- </div> -->
        <!-- <div class="art_list">  -->
     <div data-module="wrapper-ablum">
            <!-- <ul class="pic_list">
                <#list obj.artworks as artwork>
                    <li>
                        <a href="${base}/artwork/detail?artworkId=${artwork.id}">
                            <div class="pic">
                                <img lazyload="http://www.artgogo.com${artwork.cover}">
                                <div class="gradients"></div>
                                <span>￥${artwork.price}</span>
                            </div>
                            <p class="pic_name">${artwork.title}</p>
                            <p class="artist">${artwork.name}</p>
                            <p class="pic_size"><span>${artwork.pinlei}</span>|<em><#if artwork.length?? && artwork.length!=0> ${artwork.width}*${artwork.height}*${artwork.length}cm<#else>${artwork.width}*${artwork.height}cm </#if></em>
                            </p>
                        </a>
                    </li>
                </#list>
            </ul>
            <#-- banner广告位 -->
            <!-- <a href="${obj.indexContent.href!""}" class="ad">
               <img lazyload="http://www.artgogo.com${obj.indexContent.photo}">
            </a> --> 
            <ul class="pic_list no_padding">
                <li>
                    <a href="javascript:;">
                        <div class="pic">
                            <img src="images/01.jpg"  lazyload='images/09.jpg'>
                            <div class="gradients"></div>
                            <span>￥25000.00</span>
                        </div>
                        <p class="pic_name">外面的世界</p>
                        <p class="artist">小春哥</p>
                        <p class="pic_size"><span>水彩</span>|<em>25*37cm</em></p>
                    </a>
                </li>
                <li>
                    <a href="javascript:;">
                        <div class="pic">
                            <img src="images/03.jpg"   lazyload='images/10.jpg'>
                            <div class="gradients"></div>
                            <span>￥25000.00</span>
                        </div>
                        <p class="pic_name">外面的世界</p>
                        <p class="artist">小春哥</p>
                        <p class="pic_size"><span>水彩</span>|<em>25*37cm</em></p>
                    </a>
                </li>
                <li>
                    <a href="javascript:;">
                        <div class="pic">
                            <img src="images/02.jpg"  lazyload='images/08.jpg'>
                            <div class="gradients"></div>
                            <span>￥25000.00</span>
                        </div>
                        <p class="pic_name">外面的世界</p>
                        <p class="artist">小春哥</p>
                        <p class="pic_size"><span>水彩</span>|<em>25*37cm</em></p>
                    </a>
                </li>
                <li>
                    <a href="javascript:;">
                        <div class="pic">
                            <img src="images/02.jpg"  lazyload='images/07.jpg'>
                            <div class="gradients"></div>
                            <span>￥25000.00</span>
                        </div>
                        <p class="pic_name">外面的世界</p>
                        <p class="artist">小春哥</p>
                        <p class="pic_size"><span>水彩</span>|<em>25*37cm</em></p>
                    </a>
                </li>
            </ul>
            <a class="ad" data-module="ad">
                <!-- <img lazyload='http://www.artgogo.com<%this[this.length-1].big_photo%>'> -->
                <img src="images/08.jpg">
            </a>
         </div>
            
        <div id="ablumDom">
                                   
            </div>    
                <div class="loading">加载中...</div>
          
        </div>
    </div>
 <!--    <#-- 侧边栏 -->
    <!-- <#include "../component/sidebar.ftl"/> --> 
    
    <textarea id="ablumTmpl" style="display: none;">
        <ul class="pic_list">
        <!-- $.each(this,function(k,v){ -->
            <%for(var i=0,len=this.length;i<len;i++){%>
            <li>
                <a href="javascript:;">
                    <div class="pic">
                        <img lazyload='http://www.artgogo.com<%this[i].cover%>'>
                        <div class="gradients"></div>
                        <span>￥<%this[i].price%>.00</span>
                    </div>
                    <p class="pic_name"><%this[i].Title%></p>
                    <p class="artist"><%this[i].name%></p>
                    <p class="pic_size"><span><%this[i].pinlei%></span>|<em><%this[i].width%>*<%this[i].height%>cm</em></p>
                </a>
            </li>
            <%}%>
        </ul>
    </textarea>
</body>
<script src='js/basic.js'></script>
<script src='js/index.js'></script>
<script type="text/javascript">
    // 简单的节流函数
    function throttle(func, wait, mustRun) {
        var timeout,
            startTime = new Date();

        return function () {
            var context = this,
                args = arguments,
                curTime = new Date();

            clearTimeout(timeout);
            // 如果达到了规定的触发时间间隔，触发 handler
            if (curTime - startTime >= mustRun) {
                func.apply(context, args);
                startTime = curTime;
                // 没达到触发间隔，重新设定定时器
            } else {
                timeout = setTimeout(func, wait);
            }
        };
    }
    // 定义页面滚动到一定位置发送ajax请求的函数
    function isSendAjax($el) {
        return $(window).height() + $(window).scrollTop() > $el.offset().top
    }
    // 定义初始的索引以及一个布尔值
    var curIndex = 1;
    var adIndex = 1;
    var loaded=false;
    // 定义ajax请求传入的参数
    var filter={
        pinlei:"",
        price:"",
        sort:"",
        saleStatus:"",
        dimension :""
    };

    $(function () {
        // 图片裁切
        LazyLoad.Run({
            isImgCenter: true
        });
        // 定义发送ajax请求的函数
        var getArtWorks=function(opt){
            // ajax初始参数
            var defaultOpt={
                index:1,
                size:4
            };
            // 合并传入的参数到初始参数中，作为新的参数
            $.extend(defaultOpt,opt);
            $.ajax({
                    url: '/api/newwap/artwork/getFiltedArtworks',
                    data: defaultOpt,
                    // success: function (res) {
                    //     var tempDom=document.createDocumentFragment();
                    //     $.YGG.tmpl({dom: $(tempDom), v: $('#ablumTmpl').val(), datas: res});
                    //     $('#ablumDom').get(0).appendChild(tempDom);
                    //     LazyLoad.Run({
                    //         isImgCenter: true
                    //     });
                    //     if(!res || (res && res.length==0)){
                    //         loaded=true;
                    //         $('.loading').html('亲，只有这么多啦～');
                    //     }
                    // },
                    success: function(res) {
                        if(!res || (res && res.length==0 || res=='')){
                            loaded=true;
                            var txt='亲，只有这么多啦～';
                            txt=index=0?'暂无数据':txt;
                            $('.loading').html(txt);    
                            return;
                        }
                        var tempDom = document.createDocumentFragment();
                        $.YGG.tmpl({
                            dom: $(tempDom),
                            v: $('#ablumTmpl').val(),
                            datas: res
                        });
                        $('#ablumDom').get(0).appendChild(tempDom);
                        adIndex++;
                        // 回调请求，加载广告位
                        $.ajax({
                            type: 'get',
                            url: '/newwap/index_content/getContent',
                            data: {
                                index: adIndex,
                                size: 1
       
                           },
                            success: function(res) {
                               var html = '<a href="' + res.Href + '" class="ad" data-module="ad"><img lazyload="http://www.artgogo.com' + res.Photo + '"></a>';
                                $('#ablumDom').append(html);
                            }
                        });
                    LazyLoad.Run({
                        isImgCenter: true
                    });
                },
                error:function(){
                     loaded=true;
                     $('.loading').html('亲，只有这么多啦～');
                }
            });
        }
        // 定义满足加载ajax函数的条件函数
        function realFunc() {
            // 当布尔值为ture，‘.loading’出现的时候，就开始加载，并且设置传入的参数，合并参数，调用发送ajax请求的函数
            var $el=$('.loading');
            if (isSendAjax($el)&&!loaded) {
                curIndex++;
                var opt={
                    index:curIndex,
                    size:4
                }
                $.extend(filter,opt);
                getArtWorks(filter);
            }
        }
        // 采用了节流函数
        window.addEventListener('scroll', throttle(realFunc, 500, 1000),false);


        //重置状态
        // 重置下参数，为筛选做准备
        var reset=function(filter){
            curIndex = 0;
            loaded=false;
            // 如果页面有内容的话把内容先删除
            if($("[data-module=wrapper-ablum]").length>0){
                $("[data-module=wrapper-ablum]").remove();
            }
            $("#ablumDom").html('');
            // 把索引置为0，再发送ajax请求
            $.extend(filter,{index:curIndex});
            getArtWorks(filter);
        }

        // 列表页面筛选功能
        $('.list_menu dt').click(function(e){
            // 点击上面的分类的时候，$(this).siblings()指的是dd，就是分类的父元素
            if ($(this).siblings().attr('class') != 'action') {

                $(this).siblings().addClass('action');
                $(this).parent().siblings().find('dd').removeClass('action');
                // 一旦点击了就把其他分类里面的点击样式去掉
                $(this).parent().siblings().find('dd').find('a').removeClass('screen_on');
            } else {
                $('.list_menu dd').removeClass('action');
            }
        });
        // 当点击具体的单选项的时候
        $('.select_one dd a').click(function(){
            if($(this).hasClass("screen_on")){
                // 点击完就把他的父盒子隐藏
                $(this).parent().removeClass('action');
                return;
            }
            // 定义要传入的参数变量
            var pinlei="";
            var price="";
            var sort ="";
            // 获取当前点击的a链接的内容，就是筛选的词条
            switch($(this).parent().parent().index()){
                case 0:pinlei=$(this).text();break;
                case 1:price=$(this).attr('data-code');break;
                case 2:sort=$(this).attr('data-code');break;
            }
            // 把变量存入filter
            filter={
                pinlei:pinlei,
                price:price,
                sort:sort,
                saleStatus:""
            }
            // 重置下参数以及把页面html清空
            reset(filter);
            // 改变样式
            $(this).addClass('screen_on');
            $(this).siblings().removeClass('screen_on');
            $(this).parent().removeClass('action');
        });
        // 点击筛选里面的项的时候
        $('.screen_list a').click(function(e){
            if($(this).attr('class')!='screen_on'){
                $(this).addClass('screen_on');
                $(this).siblings().removeClass('screen_on');
            }else{
                $(this).removeClass('screen_on');            
            }
        });
        // 点击取消的时候
        $('.cancel_screen').click(function(){
            $('.screen_list a').removeClass('screen_on');
        });
        // 点击确定的时候
        $('.screen_str').click(function(){
            $('.screen dd').removeClass('action');
            var saleStatus=$(".sell .screen_on").text();
            var year=$(".year .screen_on").attr("data-code");
            var size=$(".size .screen_on").attr("data-code");
            filter={
               saleStatus:saleStatus,
               year:year,
               dimension:size
            }
            reset(filter);
        });
    })
</script>
</html>