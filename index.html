<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <link rel="stylesheet" type="text/css" href="./style/basic.css">
    <link rel="stylesheet" type="text/css" href="./style/index.css">
    <meta name="Keywords" content="轮播页面">
    <meta name="description" content="轮播页面">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <meta property="qc:admins" content="2275617726564116375">
    <meta http-equiv="Cache-Control" content="no-transform ">
    <meta name="applicable-device" content="mobile">
    <meta name="viewport" content="minimal-ui=yes,width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
    <style>
  
   
    </style>
</head>

<body>
    <div class="slideshow wrap page page-current">
        <header data-header="scroll">
            <div class="sign clearfix">
                <a href="javascript:;">SIGN<span>UP</span>注册</a>
                <a href="javascript:;">LOG<span>IN</span>登录</a>
            </div>
            <div class="con_top">
                <div class="top_menu open-panel" data-panel=".panel-left"><span>2</span></div>
                <div class="top_logo"> </div>
                <div class="search" id="search"></div>
            </div>
        </header>
        <div class="index_content">
            <!-- //banner开始 -->
            <div class="wap_banner" id="benlai_banner">
                <div class="wap_pic" data-module="content">
                    <a href="javascript:;"><img src="images/load.jpg" data-src="images/1_03.jpg"></a>
                    <a href="javascript:;"><img src="images/load.jpg" data-src="images/01.jpg"></a>
                    <a href="javascript:;"><img src="images/load.jpg" data-src="images/02.jpg"></a>
                    <a href="javascript:;"><img src="images/load.jpg" data-src="images/03.jpg"></a>
                </div>
                <ul data-module="nav">
                    <li class="">
                        <a></a>
                    </li>
                    <li class="">
                        <a></a>
                    </li>
                    <li class="">
                        <a></a>
                    </li>
                    <li class="">
                        <a></a>
                    </li>
                </ul>
            </div>
        </div>
        <!-- 作品列表 -->
       
        <div  class="album" id="album" data-module="wrapper-ablum">
             <ul class="album_list" data-module="content2">
                <li class="">
                    <div class="album_show  clearfix">
                        <div class="album_shadow" >
                            <div class="album_box"><img src="images/1_03.jpg" data-src="images/01.jpg"></div>
                        </div>
                        <div class="pic_message">
                            <p class="art_name">
                                <span>外面的世界</span>
                            </p>
                            <p class="art_type clearfix">
                                <a class="pic_font">水彩<span class="line">|</span>小春哥<span class="line">|</span>25*37cm<span class="line">|</span>2016</a>
                                <a href="javascript:;">详情</a>
                            </p>
                            <div class="artist_box clearfix">
                                <span class="artist_img"><img src="images/art_details_pic.jpg"></span>
                                <span class="artist_name">小春哥</span>
                                <a class="praise mt"><font>56</font>次赞<s></s></a>
                            </div>
                            <div class="buy">
                                <span class="price">￥25000.00</span>
                                <a href="javascript:;" class="buy_menu">立即购买</a>
                            </div>
                        </div>
                    </div>
                </li>
                 <li class="">
                    <div class="album_show  clearfix">
                        <div class="album_shadow">
                            <div class="album_box"><img src="images/1_03.jpg" data-src="images/02.jpg"></div>
                        </div>
                        <div class="pic_message">
                            <p class="art_name">
                                <span>外面的世界</span>
                            </p>
                            <p class="art_type clearfix">
                                <a class="pic_font">水彩<span class="line">|</span>小春哥<span class="line">|</span>25*37cm<span class="line">|</span>2016</a>
                                <a href="javascript:;">详情</a>
                            </p>
                            <div class="artist_box clearfix">
                                <span class="artist_img"><img src="images/art_details_pic.jpg"></span>
                                <span class="artist_name">小春哥</span>
                                <a class="praise mt"><font>56</font>次赞<s></s></a>
                            </div>
                            <div class="buy">
                                <span class="price">￥25000.00</span>
                                <a href="javascript:;" class="buy_menu">立即购买</a>
                            </div>
                        </div>
                    </div>
                </li>
                 <li class="">
                    <div class="album_show  clearfix">
                        <div class="album_shadow">
                            <div class="album_box"><img src="images/art_details_pic.jpg" data-src="images/03.jpg"></div>
                        </div>
                        <div class="pic_message">
                            <p class="art_name">
                                <span>外面的世界</span>
                            </p>
                            <p class="art_type clearfix">
                               <a class="pic_font">水彩<span class="line">|</span>小春哥<span class="line">|</span>25*37cm<span class="line">|</span>2016</a>
                                <a href="javascript:;">详情</a>
                            </p>
                            <div class="artist_box clearfix">
                                <span class="artist_img"><img src="images/art_details_pic.jpg"></span>
                                <span class="artist_name">小春哥</span>
                                <a class="praise mt"><font>56</font>次赞<s></s></a>
                            </div>
                            <div class="buy">
                                <span class="price">￥25000.00</span>
                                <a href="javascript:;" class="buy_menu">立即购买</a>
                            </div>
                        </div>
                    </div>
                </li>
                 <li class="">
                    <div class="album_show  clearfix">
                        <div class="album_shadow">
                            <div class="album_box"><img src="images/art_details_pic.jpg" data-src="images/1_03.jpg"></div>
                        </div>
                        <div class="pic_message">
                            <p class="art_name">
                                <span>外面的世界</span>
                            </p>
                            <p class="art_type clearfix">
                                <a class="pic_font">水彩<span class="line">|</span>小春哥<span class="line">|</span>25*37cm<span class="line">|</span>2016</a>
                                <a href="javascript:;">详情</a>
                            </p>
                            <div class="artist_box clearfix">
                                <span class="artist_img"><img src="images/art_details_pic.jpg"></span>
                                <span class="artist_name">小春哥</span>
                                <a class="praise mt"><font>56</font>次赞<s></s></a>
                            </div>
                            <div class="buy">
                                <span class="price">￥25000.00</span>
                                <a href="javascript:;" class="buy_menu">立即购买</a>
                            </div>
                        </div>
                    </div>
                </li>
              
            </ul>
        </div>
        <!-- 作品列表结束 -->
        <div class="ad" data-module="ad">
            <img src="images/art_details_pic.jpg">
        </div>
        <!-- <div class="explain">
            <ul class="pic_show maxW">
                <li>
                    <div class="details_show  clearfix">
                        <div class="pic_shadow">
                            <div class="pic_box"><img src="images/art_details_pic.jpg"></div>
                        </div>
                        <div class="pic_masseag">
                            <p class="art_name">
                                <span>外面的世界</span>
                            </p>
                            <p class="art_type clearfix"> 
                                <a class="pic_font">水彩<span class="line">|</span>小春哥<span class="line">|</span>25*37cm<span class="line">|</span>2016</a>
                                <a href="javascript:;">详情</a>
                            </p>
                            <div class="artist_box clearfix">
                                <span class="artist_img"><img src="images/art_details_pic.jpg"></span>
                                <span class="artist_name">小春哥</span>
                                <a class="praise mt"><font>56</font>次赞<s></s></a>
                            </div>
                            <div class="buy">
                                <span class="price">￥25000.00</span>
                                <a href="javascript:;" class="buy_menu">立即购买</a>
                            </div>
                        </div>
                    </div>
                </li>
            </ul>
        </div> -->
        <div id="indexCon"></div>
        <div class="loading">加载中...</div>
        <!-- 底部广告 -->
        <div class="ad" data-module="ad">
            <img src="images/art_details_pic.jpg">
        </div>
        <div class="explain">
            <p class="title">人间何处得飘然，归梦入</p>
            <p class="font">“雨水”如期而至，今天的上海阳光明媚，昨日倒是来了一波冷空气降了雨，让人意识到还在寒冬。可过了“雨水”，春天就要回来了。</p>
            <span class="date">2017/2/28<span></span></span>
        </div>
        <div class="ad">
            <img src="images/art_details_pic.jpg">
        </div>
         <div class="explain">
            <p class="title">人间何处得飘然，归梦入</p>
            <p class="font">“雨水”如期而至，今天的上海阳光明媚，昨日倒是来了一波冷空气降了雨，让人意识到还在寒冬。可过了“雨水”，春天就要回来了。</p>
            <span class="date">2017/2/28<span></span></span>
        </div>
    </div>
   <textarea style="display: none" id="indexDom">
       <div class="explain">
           <ul class="pic_show maxW">
           <%for(var i=0,len=this.length;i<len;i++){%>
               <li>
                    <div class="album_show  clearfix">
                        <a href="http://www.artgogo.com/newwap/artwork/detail?artworkId=<%this[i].id%>" class="album_shadow">
                            <div class="album_box">
                                <div class="lazy_load_img">
                                    <img lazyload='http://www.artgogo.com<%this[i].cover%>'>
                                </div>
                            </div>
                        </a>
                        <div class="pic_message">
                            <p class="art_name">
                                <span><%this[i].title%></span>
                            </p>
                            <p class="art_type clearfix">
                               <a class="pic_font"><%this[i].pinlei%><span class="line">|</span><%this[i].name%><span class="line">|</span><%this[i].width%>*<%this[i].height%>cm<span class="line">|</span><%this[i].czsj%></a>
                                <a href="javascript:;">详情</a>
                            </p>
                            <div class="artist_box clearfix">
                                <span class="artist_img"><img src="http://www.artgogo.com<%this[i].artistPhoto%>"></span>
                                <span class="artist_name"><%this[i].name%></span>
                                <a class="praise mt"><font><%this[i].attention%></font>次赞<s></s></a>
                            </div>
                            <div class="buy">
                                <span class="price">￥<%this[i].price%>.00</span>
                                <a href="javascript:;" class="buy_menu">立即购买</a>
                            </div>
                        </div>
                    </div>
                </li>
               <%}%>
           </ul>
       </div>
   </textarea>
</body>
<script type="text/javascript" src='./js/basic.js'></script>
<script type="text/javascript" src='./js/index.js'></script>
<script type="text/javascript">
$(function(){
    LazyLoad.Run({
        isImgCenter:true
    });


    ;(function(w, $, undefined) {
    if (!$) {
        return
    }
    var CSS3 = function() {// $(this).css( CSS3({ "transform": "translate3d(" + 100 * k + "%, 0, 0)" }) )
        var o = {},
        output;
        var prefix = ["-webkit-", "-moz-", "-ms-", "-o-"];
        if (typeof arguments[0] == "string") {
            o[arguments[0]] = arguments[1]
        } else {
            o = arguments[0]
        }
        for (var k in o) {
            for (var i = 0, len = prefix.length; i < len; i++) {
                o[prefix[i] + k] = o[k]
            }
        }
        return o
    };
    var Swiper = function(o) {
        o = o || {};
        this.o = $.extend({
            init: function() {},
            before: function() {},
            moving: function() {},
            after: function() {}
        },
        o);
        this.init()
    };
    Swiper.prototype = {
        initData: function() {
            var that = this;
            that.touchLock = false;
            that.interval = null;
            that.$el = that.o.$el;
            
            that.content = that.$el.find("[data-module=content2]");
            that.item = that.content.children();
            var first = that.item.first().clone();
            var last = that.item.last().clone();
            that.content.append(first);
            that.content.prepend(last);
            that.item = that.content.children();
            that.length = that.item.length;
            that.index = 1;
            //that.nav = that.$el.find("[data-module=nav]")
        },
        initPage: function() {
            var that = this;
            that.item.each(function(k, v) {
                $(this).css(CSS3({
                    "transform": "translate3d(" + 72 * k + "%, 0, 0)"
                }))
            });
            that.item.find('.pic_message').hide();
            that.item.eq(1).find('.pic_message').show();
            that.item.eq(1).find('.album_shadow').animate(CSS3({'transform':'scale(1);'}),400);
            that.setPos( -72 * that.index + "%", false)
        },
        setPos: function(pos, needTransition) {
            var that = this;
            that.loadImage(that.item.eq(that.index).prev().find("img[data-src]"));
            that.loadImage(that.item.eq(that.index).next().find("img[data-src]"));
            var ani = {};
            ani.transition = needTransition ? "all 0.4s ease": "all 0s ease";
            ani.transform = "translate3d(" + pos + ", 0, 0)";
            that.content.css(CSS3(ani));
            //that.nav.children().removeClass("on").eq(that.index - 1).addClass("on");
            setTimeout(function() {
                if (that.index <= 0) {
                    that.index = that.length - 2;
                    that.setPos( - 72 * that.index + "%", false);
                     that.item.find('.pic_message').hide();
                    that.item.eq(that.index).find('.pic_message').show();
                    that.item.find('.album_shadow').css(CSS3({'transform':'scale(0.8);'}));
                    that.item.eq(that.index).find('.album_shadow').animate(CSS3({'transform':'scale(1);'}),400);
                    return false
                }
                if (that.index >= that.length - 1) {
                    that.index = 1;
                    that.setPos( - 72 * that.index + "%", false);
                     that.item.find('.pic_message').hide();
                    that.item.eq(that.index).find('.pic_message').show();
                    that.item.find('.album_shadow').css(CSS3({'transform':'scale(0.8);'}));
                    that.item.eq(that.index).find('.album_shadow').animate(CSS3({'transform':'scale(1);'}),400);
                    return false
                }
            },
            400)
        },
        bindEvent: function() {
            var that = this;
            var $el = that.$el;
            var pos = {};
            var direction = "";
            $el[0].addEventListener("touchstart", 
            function(ev) {
                direction = "";
                that.stop();
                pos.x1 = ev.touches[0].pageX;
                pos.y1 = ev.touches[0].pageY;
                return
            },
            false);
            $el[0].addEventListener("touchmove", 
            function(ev) {
                pos.x2 = ev.touches[0].pageX;
                pos.y2 = ev.touches[0].pageY;
                var x = pos.x2 - pos.x1;
                var y = pos.y2 - pos.y1; ! direction && (direction = Math.abs(y) > Math.abs(x) ? "vertical": "horizontal");
                if (direction == "vertical") {
                    return
                }
                var width = $el.width()*0.72;
                // console.log(width);
                that.setPos(x - that.index * width + "px", false);
                ev.preventDefault();
                return false
            },
            false);
            $el[0].addEventListener("touchend", 
            function(ev) {
                pos.x2 = ev.changedTouches[0].pageX;
                pos.y2 = ev.changedTouches[0].pageY;
                var x = pos.x2 - pos.x1;
                var y = pos.y2 - pos.y1;
                var width = $el.width();
                if (direction == "vertical" || Math.abs(x) < 30) {
                    return
                }
                if (x > 0) {
                    that.index--
                } else {
                    that.index++
                }
                that.setPos( - 72 * that.index + "%", true);
                that.item.find('.pic_message').hide();
                that.item.eq(that.index).find('.pic_message').show();
                that.item.find('.album_shadow').css(CSS3({'transform':'scale(0.8);'}));
                that.item.eq(that.index).find('.album_shadow').animate(CSS3({'transform':'scale(1);'}),400);
                //that.play();
                ev.preventDefault();
                return false
            },
            false)
        },
        play: function() {
            var that = this;
            that.stop();
            that.interval = w.setInterval(function() {
                that.index++;
                that.setPos( - 72 * that.index + "%", true)
            },
            4000)
        },
        stop: function() {
            var that = this;
            w.clearInterval(that.interval)
        },
        loadImage: function($img, callback) {
            if (! ($img && $img.length)) return;
            var src = $img.attr("data-src");
            $img.attr("src", src).removeAttr("data-src");
            callback && ($img[0].onload = function() {
                callback();
                $img[0].onload = null
            })
        },
        init: function() {
            var that = this;
            that.touchLock = false;
            that.interval = null;
            that.$el = that.o.$el;
            that.content = that.$el.find("[data-module=content2]");
            that.item = that.content.children();
            that.length = that.item.length;
            if (that.length <= 1) return;
            that.loadImage(that.item.last().find("img[data-src]"),  
            function() {
                that.initData();
                that.initPage();
                that.bindEvent();
                //that.play();
                that.o.init(that)
            })
        }
    };
    $.fn.Swiper= function() {
        return this.each(function() {
            new Swiper({
                $el: $(this)
            })
        })
    }
})(window, $);
$(function(){
    $("#album").Swiper()
})

});
// 简单的节流函数
function throttle(func, wait, mustRun) {
    var timeout,
        startTime = new Date();

    return function() {
        var context = this,
            args = arguments,
            curTime = new Date();

        clearTimeout(timeout);
        // 如果达到了规定的触发时间间隔，触发 handler
        if (curTime - startTime >= mustRun) {
            func.apply(context, args);
            startTime = curTime;
            // 没达到触发间隔，重新设定定时器
        } else {
            timeout = setTimeout(func, wait);
        }
    };
}
function loading($el) {
    return $(window).height() + $(window).scrollTop() > $el.offset().top
}
var curIndex = 1;
var adIndex = 1;
var loaded = false;;
$(function() {
    LazyLoad.Run({
        isImgCenter: true
    });
    function realFun() {
        var $el;
        var $wa = curIndex == 1 ? $('[data-module=wrapper-ablum]') : $('#indexCon');
        if ($wa.last().attr('data-module') == 'ad') {
            $el = $wa.last();
        } else {
            $el = $wa.last().children().last();
        }
        if (loading($el) && !loaded) {
            curIndex++;
            $.YGG.ajax({
                url: '/api/newwap/artwork/getArtworks',
                data: {
                    index: curIndex,
                    size: 4
                },
                success: function(res) {
                    var indexTmpl = document.createDocumentFragment();
                    $.YGG.tmpl({
                        dom: $(indexTmpl),
                        v: $('#indexDom').val(),
                        datas: res
                    });
                    $('#indexCon').get(0).appendChild(indexTmpl);

                    adIndex++;
                    // console.log($('#artistList'));
                    $.ajax({
                        type: 'get',
                        url: '/api/newwap/index_content/getContent',
                        data: {
                            index: adIndex,
                            size: 1
                        },
                        success: function(res) {
                            var html = '<a href="http://www.artgogo.com' + res.Href + '" class="ad" data-module="ad"><img lazyload="http://www.artgogo.com' + res.Photo + '"></a>';
                            $('#indexCon').append(html);
                        }
                    });
                    LazyLoad.Run({
                        isImgCenter: true
                    });
                    if (!res || (res && res.length == 0)) {
                        loaded = true;
                        $('.loaede').html('亲只有这么多啦～');
                    }
                },
                error: function() {
                    loaded = true;
                    $('.loaded').html('亲只有这么多啦～');
                }
            });
        }
    };
    window.addEventListener('scroll', throttle(realFun, 500, 1000));


});
</script>
</html>
