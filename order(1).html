<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <link rel="stylesheet" type="text/css" href="style/basic.css">
    <link rel="stylesheet" type="text/css" href="style/index.css">
    <meta name="Keywords" content="后台订单页面">
    <meta name="description" content="后台订单页面">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <meta property="qc:admins" content="2275617726564116375">
    <meta http-equiv="Cache-Control" content="no-transform ">
    <meta name="applicable-device" content="mobile">
    <meta name="viewport"
          content="minimal-ui=yes,width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
          <style type="text/css">
              .order dd .order_pic{
                position: relative;
              }
          </style>
</head>

<body>
<div class="wrap page page-current">
    <div class="con_top" id="conTop" data-header="scroll">
        <div class="top_menu open-panel" data-panel=".panel-left"><span>2</span></div>
        <div class="top_logo"></div>
        <div class="search" id="search"></div>
    </div>
    <!-- 内容部分 -->
    <div class="order_page">
        <!-- 订单列表 -->
        <div class="nav-tab-top">
            <ul class="clearfix">
                <li class="cur" data-code="allOrdersDom" id="all" isrender="1"><a href="javascript:;">全部</a></li>
                <li data-code="daifukuangDom" isrender="1"><a href="javascript:;">待付款</a></li>
                <li data-code="daishouhuoDom" isrender="1"><a href="javascript:;">待收货</a></li>
                <li data-code="wanchengDom" isrender="1"><a href="javascript:;">已完成</a></li>
                <li data-code="shouhouDom" isrender="1"><a href="javascript:;">退款/售后</a></li>
            </ul>
        </div>
        <ul class="order_con_list">
            <li style="display: block" id="allOrdersDom">
               <!--  <div class="order_list">
                    <ul>
                        <li>
                            <div class="order_mes clearfix">
                                <div class="order_num">订单号：<span>12345678901234</span> ></div>
                                <div class="state non_payment"><a>立即支付</a></div>
                            </div>
                            <dl class="order clearfix">
                                <dt>卖家：<a href="javascript:;" class="shop">艺高高直营店</a></dt>
                                <dd>
                                    <a href="javascript:;" class="clearfix">
                                        <div class="order_pic"><img src="images/01.jpg"></div>
                                        <div class="order_message">
                                            <p>外面的世界</p>
                                            <p class="pic_type">水彩<span class="line">|</span>小春哥<span
                                                    class="line">|</span>25*37cm<span class="line">|</span>2016</p>
                                            <p>原创艺术品</p>
                                            <em class="o_price">￥25000.00元</em>
                                        </div>
                                    </a>
                                </dd>
                            </dl>
                        </li>

                        <li>
                            <div class="order_mes clearfix">
                                <div class="order_num">订单号：<span>00000000000000</span> ></div>
                                <div class="state"><a>待发货</a></div>
                            </div>
                            <dl class="order clearfix">
                                <dt>卖家：<a href="javascript:;" class="shop">艺高高直营店</a></dt>
                                <dd>
                                    <a href="javascript:;" class="clearfix">
                                        <div class="order_pic"><img src="images/01.jpg"></div>
                                        <div class="order_message">
                                            <p>外面的世界</p>
                                            <p class="pic_type">水彩<span class="line">|</span>小春哥<span
                                                    class="line">|</span>25*37cm<span class="line">|</span>2016</p>
                                            <p>原创艺术品</p>
                                            <em class="o_price">￥25000.00元</em>
                                        </div>
                                    </a>
                                </dd>
                            </dl>
                            <dl class="order clearfix">
                                <dt>卖家：<a href="javascript:;" class="shop">小卖部</a></dt>
                                <dd>
                                    <a href="javascript:;" class="clearfix">
                                        <div class="order_pic"><img src="images/01.jpg"></div>
                                        <div class="order_message">
                                            <p>外面的世界</p>
                                            <p class="pic_type">水彩<span class="line">|</span>小春哥<span
                                                    class="line">|</span>25*37cm<span class="line">|</span>2016</p>
                                            <p>原创艺术品</p>
                                            <em class="o_price">￥25000.00元</em>
                                        </div>
                                    </a>
                                </dd>
                                <dd>
                                    <a href="javascript:;" class="clearfix">
                                        <div class="order_pic"><img src="images/01.jpg"></div>
                                        <div class="order_message">
                                            <p>外面的世界</p>
                                            <p class="pic_type">水彩<span class="line">|</span>小春哥<span
                                                    class="line">|</span>25*37cm<span class="line">|</span>2016</p>
                                            <p>原创艺术品</p>
                                            <em class="o_price">￥25000.00元</em>
                                        </div>
                                    </a>
                                </dd>
                            </dl>
                        </li>
                    </ul>
                </div> -->
                <div class="loading">加载中...</div>
                <div class="null-data" style="display: none;">暂无订单</div>
            </li>
            <li id="daifukuangDom">
                <div class="null-data">暂无订单</div>
            </li>
            <li id="daishouhuoDom">
                <div class="null-data">暂无订单</div>
            </li>
            <li id="wanchengDom">
                <div class="null-data">暂无订单</div>
            </li>
            <li id="shouhouDom">
                <div class="null-data">暂无订单</div>
            </li>
        </ul>

    </div>
    <!-- 内容部分 -->
</div>
<textarea style="display: none" id="allOrdersTmpl">
    <div class="order_list">
                    <ul>
                        <%$.each(this,function(k,v){%>
                             <%for(od in v){%>
                        <li>
                            <div class="order_mes clearfix">    
                                <div class="order_num">订单号：<span><%od.split("#")[0]%></span></div>
                                <div class="state"><a><%orderStatus[od.split("#")[1]]%></a></div>
                            </div>
                            <%$.each(v[od],function(k2,v2){%>
                                 <%for(nm in v2){%>
                                    <dl class="order clearfix">
                                        <dt>卖家：<a href="javascript:;" class="shop"><%nm%></a></dt>
                                         <%$.each(v2[nm],function(k3,v3){%>
                                            <dd>
                                                <a href="javascript:;" class="clearfix">
                                                    <div class="order_pic"><img src="http://www.artgogo.com<%v3.Photo%>"></div>
                                                    <div class="order_message">
                                                        <p><%v3.goods_name%></p>
                                                        <p class="pic_type">水彩<span class="line">|</span>小春哥<span
                                                                class="line">|</span>25*37cm<span class="line">|</span>2016</p>
                                                        <p>原创艺术品</p>
                                                        <em class="o_price">￥25000.00元</em>
                                                    </div>
                                                </a>
                                            </dd>
                                         <%});%>
                                    </dl>
                               <%}%>
                            <%});%>
                        </li>
                        <%}%>
                     <%});%>
                    </ul>
            </div>
</textarea>
</body>
<script src='./js/basic.js'></script>
<script src='./js/index.js'></script>
<script>
var orderStatus={
    "1":"待付款",
    "2":"待收货",
    "3":"已完成",
    "4":"退款／售后"
};
var orderData={
    "daifukuangDom":[],
    "daishouhuoDom":[],
    "wanchengDom":[],
    "shouhouDom":[]
}

var imgClip=function($this,$parent){
    var imgBoxW=$parent.width();
    var imgBoxH=$parent.height();
    var imgW=$this.width();
    var imgH=$this.height();
    var rate =imgBoxW / imgBoxH;
    var ratio = imgW / imgH;
    var sw, sh, sx, sy;
    if(ratio>rate){
    sh=imgBoxH;
    sw=ratio*imgBoxH;
    sy=0;
    sx=(imgBoxW-sw)/2;
    }else{
    sw=imgBoxW;
    sh=imgBoxW/ratio;
    sx=0;
    sy=(imgBoxH-sh)/2;
    }
    $this.css({
     position:'absolute',
     left:sx+'px',
     top:sy+'px',
     width:sw+'px',
     height:sh+'px'
    });
}

    $(function () {
            $.ajax({
                type: "POST",
                dataType: "json",
                url: "/newwap/order/getTestOrders",
                data: {
                    index: 1,
                    size: 100
                },
                success: function (res) {
                    if(res && res.length>0){
                        $.YGG.tmpl({dom: $("#allOrdersDom"), v: $('#allOrdersTmpl').val(), datas: res});
                        $("[data-code=allOrdersDom]").attr("isrender",0);
                         for(var i=0,len=res.length;i<len;i++){
                            for(od in res[i]){
                                if(od.split("#")[1]==1){
                                    orderData["daifukuangDom"].push(res[i]);
                                }
                                if(od.split("#")[1]==2){
                                    orderData["daishouhuoDom"].push(res[i]);
                                }
                                if(od.split("#")[1]==3){
                                    orderData["wanchengDom"].push(res[i]);
                                }
                                if(od.split("#")[1]==4){
                                    orderData["shouhouDom"].push(res[i]);
                                }
                            }
                         }
                         var imglth=$("#allOrdersDom").find('img').length;
                         var a=function(){
                                d++;
                                if(d == imglth){
                                    $("#allOrdersDom").find('img').each(function(){
                                            imgClip($(this),$(this).parent());
                                        });
                                }
                            }
                        for (var c = imglth, d = 0, e = 0; c > e; e++) {
                            var g = new Image;
                            g.onload = a,g.onerror=a,g.src =$("#allOrdersDom").find('img').eq(d).attr("src");
                        }                  
                    

                            // 订单页面顶部table切换
                            var curI='';
                            $('.nav-tab-top ul li').click(function(){
                                var curI=$(this).index();
                                if($(this).attr('class')!='cur'){
                                    $(this).addClass('cur');
                                    $(this).siblings().removeClass('cur');
                                    $('.order_con_list>li').eq(curI).css('display','block');
                                    $('.order_con_list>li').eq(curI).siblings().css('display','none');
                                    if($(this).attr('isrender')==0){
                                        return;
                                    }
                                    var dataCode=$(this).attr('data-code');
                                    $(this).attr('isrender',0);
                                    if(orderData[dataCode] && orderData[dataCode].length==0) return;
                                    $.YGG.tmpl({dom: $("#"+dataCode), v: $('#allOrdersTmpl').val(), datas: orderData[dataCode]});
                                    $("#"+dataCode).find('img').each(function(){
                                            imgClip($(this),$(this).parent());
                                        });
                                }

                            });
                        
                    }else{
                        $("#allOrdersDom .loading").hide();
                        $("#allOrdersDom .null-data").show();
                    }
                }
            });
    });
</script>

</html>