<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <link rel="stylesheet" type="text/css" href="style/basic.css">
    <meta name="Keywords" content="购物车页面">
    <meta name="description" content="购物车页面">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <meta property="qc:admins" content="2275617726564116375">
    <meta http-equiv="Cache-Control" content="no-transform ">
    <meta name="applicable-device" content="mobile">
    <meta name="viewport" content="minimal-ui=yes,width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
</head>

<body>
    <div class="wrap page page-current">
        <!-- 头部 -->
        <div class="con_top" id="conTop" data-header="scroll">
            <div class="top_menu open-panel" data-panel=".panel-left"><span>2</span></div>
            <div class="top_logo"> </div>
            <div class="search" id="search"></div>
        </div>
        <!-- 内容部分 -->

        <div id="buyCarPages">

            <div class="confrim_order">
                <div class="chose_all">
                    <a class="chose">全选</a> 
                    <p>已选<span class="pic_number">2</span>件</p>      
                </div>
                    <div class="buy_car_order_box order_box">
                        <ul class="buy_car_list" id="buyCarList">
                            <!-- <li class="clearfix">
                                <div class="buy_car_chose">
                                     <a class="chose"></a>  
                                 </div>
                                <dl class="order">
                                    <dt>卖家：<a href="javascript:;" class="shop">艺高高直营店</a></dt>
                                    <dd>
                                        <a href="javascript:;" class="clearfix">
                                            <div class="order_pic"><img src="images/01.jpg"></div>
                                            <div class="order_message">
                                                <p>外面的世界</p>
                                                <p class="pic_type">水彩<span class="line">|</span>小春哥<span class="line">|</span>25*37cm<span class="line">|</span>2016</p>
                                                <p>原创艺术品</p>
                                               <p class="o_price">￥<span>25000.00</span>元</p>
                                            </div>
                                        </a>
                                    </dd>
                                </dl> 
                            </li>
                            <li class="clearfix">
                                <div class="buy_car_chose">
                                     <a class="chose"></a>  
                                 </div>
                                <dl class="order">
                                    <dt>卖家：<a href="javascript:;" class="shop">艺高高直营店</a></dt>
                                    <dd>
                                        <a href="javascript:;" class="clearfix">
                                            <div class="order_pic"><img src="images/01.jpg"></div>
                                            <div class="order_message">
                                                <p>外面的世界</p>
                                                <p class="pic_type">水彩<span class="line">|</span>小春哥<span class="line">|</span>25*37cm<span class="line">|</span>2016</p>
                                                <p>原创艺术品</p>
                                               <em class="o_price">￥25000.00元</em>
                                            </div>
                                        </a>
                                    </dd>
                                </dl> 
                            </li>        -->       
                        </ul>
                    </div>
                    <!-- 个人信息部分 -->
                    <div class="city">
                        <ul>
                            <li>姓&#12288;&#12288;名:
                                <input class="receive_contact" id="receiveContact" type="text" value="" placeholder="请填写收货人姓名">
                            </li>
                            <li>联系方式:
                                <input class="receive_cellPhone" id="receiveCellPhone" type="tel" value="" placeholder="手机号码">
                            </li>
                            <li>联系地址:
                                 <!-- <a href="address.html"> -->
                                    <input class="distSelect_event"  id="distSelectEvent" type="text" value="" placeholder="添加收货地址" >  
                                    <!-- <span class="add">+</span> -->
                                <!-- </a>  -->
                            </li>   
                            <li>备&#12288;&#12288;注:
                                <input class="receive_message"  id="receiveMessage" type="text" value="" placeholder="选填" >  
                            </li> 
                            <li>选择支付方式:
                                <input readonly="readonly">
                            </li>  
                        </ul>
                        <div class="payment">
                            <a class="weixin "><div class="chose"></div><span>微信钱包</span></a>
                            <a class="zhifubao"><div></div><span>支付宝</span></a>
                            <!-- <a class="bank"><div></div><span>中国银联</span></a> -->
                        </div>
                    </div>
                
                <!-- 订单信息 --> 
             </div> 
            
            <footer class="buy_car">
                <div class="count">￥<span>25000.00</span>元</div>
                <div class="buy_now">
                    <a class="add_buy_car"></a>
                    <a class="purchase">立即支付</a>
                </div>
            </footer>
        </div> 

        <div class="null-data">
            <div class="no_order no_commodity">
                <div class="no_order_img"><img src="images/no_order.png"></div>
                <p>购物车竟然是空的，去添加点什么吧～</p>
            </div>
        </div>
    </div>

<textarea id="buyCar" style="display: none">
    <%for(var i=0,len=this.length;i<len;i++){%>
            <div class="hasId" style="display: none"> 
                {"pa_id":<%this[i].pa_id%>,"pd_id":<%this[i].pd_id%>}
            </div>
        <li class="clearfix list_li">
            <div class="buy_car_chose">
                 <a class="chose"></a>  
             </div>
            <dl class="order">
                <dt>卖家：<a href="javascript:;" class="shop"><%this[i].artwork.m_name%></a></dt>
                <dd>
                    <a href="http://www.artgogo.com:888/newwap/artwork/detail?artworkId=<%this[i].artwork.id%>" class="clearfix">
                        <div class="order_pic"><img lazyload="http://www.artgogo.com<%this[i].artwork.cover%>"></div>
                        <div class="order_message">
                            <p><%this[i].artwork.Title%></p>
                            <p class="pic_type"><%this[i].artwork.pinlei%><span class="line">|</span><%this[i].artwork.name%><span class="line">|</span><%this[i].artwork.width%>*<%this[i].artwork.height%>cm<span class="line">|</span><%this[i].artwork.czsj%></p>
                            <p>原创艺术品</p>
                            <p class="o_price">￥<span><%this[i].artwork.price%>.00</span>元</p>
                            
                        </div>
                    </a>
                </dd>
            </dl> 
        </li>
    <%}%>
</textarea>
    <!-- 侧边栏 -->
    <!-- 侧边栏结束-->
</body>
<script src='./js/basic.js'></script>
<script src='./js/index.js'></script>
<script>
var artId=[];
 // {"pa_id":<%this[i].pa_id%>,"pd_id":<%this[i].pd_id%>}
    $(function(){
        
        $.ajax({
            type: "POST",
            dataType: "json",
            url:'/newwap/cart/getTestCart',
            success:function(res){
                if(res || res.length>0){
                    $(".null-data").hide();
                    $('.pic_number').html(res.length);
                    var buyCarDom=document.createDocumentFragment();
                    $.YGG.tmpl({dom: $(buyCarDom), v: $('#buyCar').val(), datas: res});
                    $('#buyCarList').get(0).appendChild(buyCarDom);
                    LazyLoad.Run({
                        isImgCenter: true
                    });
                    getPrice();
                }else if(!res || (res && res.length==0 || res=='')){
                    $('#buyCarPages').hide();
                    $(".null-data").show(); 
                }
            }
        }); 
       

    // 购物车页面订单全选功能
       $('.chose_all a').tap(function(){

           if($(this).attr('class')!='chose'){
               $(this).addClass('chose');
               $('.buy_car_chose a').addClass('chose');

           }else{
               $(this).removeClass('chose');
               $('.buy_car_chose a').removeClass('chose');
           }
           $('.pic_number').html($('.buy_car_chose .chose').length);
           getPrice();

        });


       $('.buy_car_list').on('tap','.buy_car_chose',function(){
           
           var $a=$(this).children();
           if($a.attr('class')!='chose'){
               $a.addClass('chose');
           }else{
               $a.removeClass('chose');
           }
       
           if($('.buy_car_chose .chose').length==$('.buy_car_chose a').length){
               $('.chose_all a').addClass('chose');
           }else{
               $('.chose_all a').removeClass('chose');
           }
           $('.pic_number').html($('.buy_car_chose .chose').length);
           getPrice();
       });
        // 点击立即支付
        $('.purchase').tap(function(){
            var Id=[];
            var num=$('.pic_number').html();
            var count=$('.count span').html();
            var $li=$('.buy_car_list li');
            var Address=$('.receive_contact').val() + $('.receive_cellPhone').val() + $('.distSelect_event').val();
            var receives=$('.receive_message').val();
            for(var i=0;i<$li.length;i++){
                Id.push($('.hasId').eq(i).html());
            }
            var pay_method=$('.payment .chose').siblings().html();
            $.ajax({
                // url:"",
                data:{
                    id:Id,
                    size:num,
                    price:count,
                    address:Address,
                    receive:receives,
                    method:pay_method
                }
            });
        });

    });
    var getPrice=function(){
       var $li=$('.buy_car_list li');
       var Price=[];
       var count=0;
       for(var i=0;i<$li.length;i++){
            if($li.eq(i).find('.buy_car_chose a').hasClass('chose')){
                Price.push(parseInt($li.eq(i).find('.o_price span').html()));
            }
       }
       Price.forEach(function(item,index,array){
           count+=item;
       });
       $('.count span').html(parseInt(count)+'.00');
    }; 
</script>
</html>